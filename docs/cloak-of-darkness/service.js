(()=>{"use strict";var a={};a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"==typeof window)return window}}();const t="iff-cache",e="./config.json";!function(a){async function n(){Promise.all((await a.caches.keys()).filter((a=>a!=t)).map((t=>a.caches.delete(t))))}async function c(){const n=await a.caches.open(t);await n.addAll((await async function(){let n=new URL(e,a.location.href),c=await(await caches.open(t)).match(n);return await c.json()}()).cacheFiles)}a.addEventListener("install",(t=>{a.skipWaiting(),t.waitUntil(c())})),a.addEventListener("activate",(t=>{t.waitUntil(Promise.all([a.clients.claim(),n()]))}));let i=!1;a.onmessage=n=>{"check"===n.data.type&&(i||(i=!0,n.waitUntil(async function(){let n=new BroadcastChannel("iff-update"),s={type:"check",available:!1},o=new URL(e,a.location.href),l=await(await caches.open(t)).match(o),h=await l.json();try{let a=await(await fetch(o,{cache:"no-cache"})).json();a.version>h.version?(await c(),(await caches.open(t)).put(o,new Response(JSON.stringify(a))),s.available=!0,i=!1):i=!1}catch{}n.postMessage(s),n.close(),i=!1}())))},a.addEventListener("fetch",(e=>{e.respondWith((async e=>await a.caches.match(e,{cacheName:t})||fetch(e))(e.request))}))}(a.g)})();