/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={197:function(e,t,n){e.exports=function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};var t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,i=Object.keys,a=Array.isArray;function s(e,t){return"object"!=typeof t||i(t).forEach((function(n){e[n]=t[n]})),e}"undefined"==typeof Promise||o.Promise||(o.Promise=Promise);var u=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function f(e,t){"function"==typeof t&&(t=t(u(e))),("undefined"==typeof Reflect?i:Reflect.ownKeys)(t).forEach((function(n){h(e,n,t[n])}))}var d=Object.defineProperty;function h(e,t,n,r){d(e,t,s(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),h(e.prototype,"constructor",e),{extend:f.bind(null,e.prototype)}}}}var y=Object.getOwnPropertyDescriptor;function v(e,t){var n;return y(e,t)||(n=u(e))&&v(n,t)}var m=[].slice;function g(e,t,n){return m.call(e,t,n)}function b(e,t){return t(e)}function w(e){if(!e)throw new Error("Assertion Failed")}function x(e){o.setImmediate?setImmediate(e):setTimeout(e,0)}function _(e,t){if("string"==typeof t&&l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,o=t.length;r<o;++r){var i=_(e,t[r]);n.push(i)}return n}var a=t.indexOf(".");if(-1!==a){var s=e[t.substr(0,a)];return null==s?void 0:_(s,t.substr(a+1))}}function $(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){w("string"!=typeof n&&"length"in n);for(var r=0,o=t.length;r<o;++r)$(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var s=t.substr(0,i),u=t.substr(i+1);if(""===u)void 0===n?a(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n;else{var c=e[s];c&&l(e,s)||(c=e[s]={}),$(c,u,n)}}else void 0===n?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function k(e){var t={};for(var n in e)l(e,n)&&(t[n]=e[n]);return t}var O=[].concat;function S(e){return O.apply([],e)}var P="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(S([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return o[e]})),E=new Set(P.map((function(e){return o[e]})));function C(e){var t={};for(var n in e)if(l(e,n)){var r=e[n];t[n]=!r||"object"!=typeof r||E.has(r.constructor)?r:C(r)}return t}var T=null;function A(e){T=new WeakMap;var t=j(e);return T=null,t}function j(e){if(!e||"object"!=typeof e)return e;var t=T.get(e);if(t)return t;if(a(e)){t=[],T.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(j(e[n]))}else if(E.has(e.constructor))t=e;else{var o=u(e);for(var i in t=o===Object.prototype?{}:Object.create(o),T.set(e,t),e)l(e,i)&&(t[i]=j(e[i]))}return t}var D={}.toString;function K(e){return D.call(e).slice(8,-1)}var I="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",B="symbol"==typeof I?function(e){var t;return null!=e&&(t=e[I])&&t.apply(e)}:function(){return null};function M(e,t){var n=e.indexOf(t);return n>=0&&e.splice(n,1),n>=0}var q={};function R(e){var t,n,r,o;if(1===arguments.length){if(a(e))return e.slice();if(this===q&&"string"==typeof e)return[e];if(o=B(e)){for(n=[];!(r=o.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var F="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},N=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(N),z={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function H(e,t){this.name=e,this.message=t}function U(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}function Y(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=U(e,t)}function W(e,t){this.name="BulkError",this.failures=Object.keys(t).map((function(e){return t[e]})),this.failuresByPos=t,this.message=U(e,this.failures)}p(H).from(Error).extend({toString:function(){return this.name+": "+this.message}}),p(Y).from(H),p(W).from(H);var V=L.reduce((function(e,t){return e[t]=t+"Error",e}),{}),G=H,Q=L.reduce((function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=z[t]||n,this.inner=null)}return p(r).from(G),e[t]=r,e}),{});Q.Syntax=SyntaxError,Q.Type=TypeError,Q.Range=RangeError;var X=N.reduce((function(e,t){return e[t+"Error"]=Q[t],e}),{});var J=L.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Q[t]),e}),{});function Z(){}function ee(e){return e}function te(e,t){return null==e||e===ee?t:function(n){return t(e(n))}}function ne(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function re(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ne(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ne(o,this.onerror):o),void 0!==i?i:n}}function oe(e,t){return e===Z?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ne(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ne(r,this.onerror):r)}}function ie(e,t){return e===Z?t:function(n){var r=e.apply(this,arguments);s(n,r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?ne(o,this.onsuccess):o),i&&(this.onerror=this.onerror?ne(i,this.onerror):i),void 0===r?void 0===a?void 0:a:s(r,a)}}function ae(e,t){return e===Z?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function se(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,o=arguments.length,i=new Array(o);o--;)i[o]=arguments[o];return n.then((function(){return t.apply(r,i)}))}return t.apply(this,arguments)}}J.ModifyError=Y,J.DexieError=H,J.BulkError=W;var ue="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ce(e,t){ue=e}var le={},fe=100,de="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,u(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,u(t),e]}(),he=de[0],pe=de[1],ye=de[2],ve=pe&&pe.then,me=he&&he.constructor,ge=!!ye;var be=function(e,t){Pe.push([e,t]),xe&&(queueMicrotask(qe),xe=!1)},we=!0,xe=!0,_e=[],$e=[],ke=ee,Oe={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Z,pgp:!1,env:{},finalize:Z},Se=Oe,Pe=[],Ee=0,Ce=[];function Te(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=Se;if("function"!=typeof e){if(e!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ke(this,this._value))}this._state=null,this._value=null,++t.ref,De(this,e)}var Ae={get:function(){var e=Se,t=Ve;function n(n,r){var o=this,i=!e.global&&(e!==Se||t!==Ve),a=i&&!Je(),s=new Te((function(t,s){Be(o,new je(it(n,e,i,a),it(r,e,i,a),t,s,e))}));return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=le,n},set:function(e){h(this,"then",e&&e.prototype===le?Ae:{get:function(){return e},set:Ae.set})}};function je(e,t,n,r,o){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=o}function De(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&Re();t&&"function"==typeof t.then?De(e,(function(e,n){t instanceof Te?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Ie(e)),n&&Fe()}}),Ke.bind(null,e))}catch(t){Ke(e,t)}}function Ke(e,t){if($e.push(t),null===e._state){var n=e._lib&&Re();t=ke(t),e._state=!1,e._value=t,function(e){_e.some((function(t){return t._value===e._value}))||_e.push(e)}(e),Ie(e),n&&Fe()}}function Ie(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Be(e,t[n]);var o=e._PSD;--o.ref||o.finalize(),0===Ee&&(++Ee,be((function(){0==--Ee&&Ne()}),[]))}function Be(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ee,be(Me,[n,e,t])}else e._listeners.push(t)}function Me(e,t,n){try{var r,o=t._value;!t._state&&$e.length&&($e=[]),r=ue&&t._consoleTask?t._consoleTask.run((function(){return e(o)})):e(o),t._state||-1!==$e.indexOf(o)||function(e){for(var t=_e.length;t;)if(_e[--t]._value===e._value)return void _e.splice(t,1)}(t),n.resolve(r)}catch(e){n.reject(e)}finally{0==--Ee&&Ne(),--n.psd.ref||n.psd.finalize()}}function qe(){ot(Oe,(function(){Re()&&Fe()}))}function Re(){var e=we;return we=!1,xe=!1,e}function Fe(){var e,t,n;do{for(;Pe.length>0;)for(e=Pe,Pe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Pe.length>0);we=!0,xe=!0}function Ne(){var e=_e;_e=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Ce.slice(0),n=t.length;n;)t[--n]()}function Le(e){return new Te(le,!1,e)}function ze(e,t){var n=Se;return function(){var r=Re(),o=Se;try{return nt(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{nt(o,!1),r&&Fe()}}}f(Te.prototype,{then:Ae,_then:function(e,t){Be(this,new je(null,null,e,t,Se))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(function(e){return e instanceof t?n(e):Le(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):Le(e)}))},finally:function(e){return this.then((function(t){return Te.resolve(e()).then((function(){return t}))}),(function(t){return Te.resolve(e()).then((function(){return Le(t)}))}))},timeout:function(e,t){var n=this;return e<1/0?new Te((function(r,o){var i=setTimeout((function(){return o(new Q.Timeout(t))}),e);n.then(r,o).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&h(Te.prototype,Symbol.toStringTag,"Dexie.Promise"),Oe.env=rt(),f(Te,{all:function(){var e=R.apply(null,arguments).map(Ze);return new Te((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(o,i){return Te.resolve(o).then((function(n){e[i]=n,--r||t(e)}),n)}))}))},resolve:function(e){return e instanceof Te?e:e&&"function"==typeof e.then?new Te((function(t,n){e.then(t,n)})):new Te(le,!0,e)},reject:Le,race:function(){var e=R.apply(null,arguments).map(Ze);return new Te((function(t,n){e.map((function(e){return Te.resolve(e).then(t,n)}))}))},PSD:{get:function(){return Se},set:function(e){return Se=e}},totalEchoes:{get:function(){return Ve}},newPSD:Qe,usePSD:ot,scheduler:{get:function(){return be},set:function(e){be=e}},rejectionMapper:{get:function(){return ke},set:function(e){ke=e}},follow:function(e,t){return new Te((function(n,r){return Qe((function(t,n){var r=Se;r.unhandleds=[],r.onunhandled=n,r.finalize=ne((function(){var e=this;!function(e){Ce.push((function t(){e(),Ce.splice(Ce.indexOf(t),1)})),++Ee,be((function(){0==--Ee&&Ne()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}}),me&&(me.allSettled&&h(Te,"allSettled",(function(){var e=R.apply(null,arguments).map(Ze);return new Te((function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach((function(e,o){return Te.resolve(e).then((function(e){return r[o]={status:"fulfilled",value:e}}),(function(e){return r[o]={status:"rejected",reason:e}})).then((function(){return--n||t(r)}))}))}))})),me.any&&"undefined"!=typeof AggregateError&&h(Te,"any",(function(){var e=R.apply(null,arguments).map(Ze);return new Te((function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,o=new Array(r);e.forEach((function(e,i){return Te.resolve(e).then((function(e){return t(e)}),(function(e){o[i]=e,--r||n(new AggregateError(o))}))}))}))})));var He={awaits:0,echoes:0,id:0},Ue=0,Ye=[],We=0,Ve=0,Ge=0;function Qe(e,t,n,r){var o=Se,i=Object.create(o);i.parent=o,i.ref=0,i.global=!1,i.id=++Ge,Oe.env,i.env=ge?{Promise:Te,PromiseProp:{value:Te,configurable:!0,writable:!0},all:Te.all,race:Te.race,allSettled:Te.allSettled,any:Te.any,resolve:Te.resolve,reject:Te.reject}:{},t&&s(i,t),++o.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=ot(i,e,n,r);return 0===i.ref&&i.finalize(),a}function Xe(){return He.id||(He.id=++Ue),++He.awaits,He.echoes+=fe,He.id}function Je(){return!!He.awaits&&(0==--He.awaits&&(He.id=0),He.echoes=He.awaits*fe,!0)}function Ze(e){return He.echoes&&e&&e.constructor===me?(Xe(),e.then((function(e){return Je(),e}),(function(e){return Je(),st(e)}))):e}function et(e){++Ve,He.echoes&&0!=--He.echoes||(He.echoes=He.awaits=He.id=0),Ye.push(Se),nt(e,!0)}function tt(){var e=Ye[Ye.length-1];Ye.pop(),nt(e,!1)}function nt(e,t){var n=Se;if((t?!He.echoes||We++&&e===Se:!We||--We&&e===Se)||queueMicrotask(t?et.bind(null,e):tt),e!==Se&&(Se=e,n===Oe&&(Oe.env=rt()),ge)){var r=Oe.env.Promise,i=e.env;(n.global||e.global)&&(Object.defineProperty(o,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function rt(){var e=o.Promise;return ge?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ot(e,t,n,r,o){var i=Se;try{return nt(e,!0),t(n,r,o)}finally{nt(i,!1)}}function it(e,t,n,r){return"function"!=typeof e?e:function(){var o=Se;n&&Xe(),nt(t,!0);try{return e.apply(this,arguments)}finally{nt(o,!1),r&&queueMicrotask(Je)}}}function at(e){Promise===me&&0===He.echoes?0===We?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+ve).indexOf("[native code]")&&(Xe=Je=Z);var st=Te.reject;function ut(e,t,n,r){if(e.idbdb&&(e._state.openComplete||Se.letThrough||e._vip)){var o=e._createTransaction(t,n,e._dbSchema);try{o.create(),e._state.PR1398_maxLoop=3}catch(o){return o.name===V.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return ut(e,t,n,r)}))):st(o)}return o._promise(t,(function(e,t){return Qe((function(){return Se.trans=o,r(e,t,o)}))})).then((function(e){if("readwrite"===t)try{o.idbtrans.commit()}catch(e){}return"readonly"===t?e:o._completion.then((function(){return e}))}))}if(e._state.openComplete)return st(new Q.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._state.autoOpen)return st(new Q.DatabaseClosed);e.open().catch(Z)}return e._state.dbReadyPromise.then((function(){return ut(e,t,n,r)}))}var ct="4.0.4",lt=String.fromCharCode(65535),ft=-1/0,dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ht="String expected.",pt=[],yt="__dbnames",vt="readonly",mt="readwrite";function gt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var bt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function wt(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=A(t))[e],t}}function xt(){throw Q.Type()}function _t(e,t){try{var n=$t(e),r=$t(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){for(var n=e.length,r=t.length,o=n<r?n:r,i=0;i<o;++i)if(e[i]!==t[i])return e[i]<t[i]?-1:1;return n===r?0:n<r?-1:1}(kt(e),kt(t));case"Array":return function(e,t){for(var n=e.length,r=t.length,o=n<r?n:r,i=0;i<o;++i){var a=_t(e[i],t[i]);if(0!==a)return a}return n===r?0:n<r?-1:1}(e,t)}}catch(e){}return NaN}function $t(e){var t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";var n=K(e);return"ArrayBuffer"===n?"binary":n}function kt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var Ot=function(){function t(){}return t.prototype._trans=function(e,t,n){var r=this._tx||Se.trans,o=this.name,i=ue&&"undefined"!=typeof console&&console.createTask&&console.createTask("Dexie: ".concat("readonly"===e?"read":"write"," ").concat(this.name));function a(e,n,r){if(!r.schema[o])throw new Q.NotFound("Table "+o+" not part of transaction");return t(r.idbtrans,r)}var s=Re();try{var u=r&&r.db._novip===this.db._novip?r===Se.trans?r._promise(e,a,n):Qe((function(){return r._promise(e,a,n)}),{trans:r,transless:Se.transless||Se}):ut(this.db,e,[this.name],a);return i&&(u._consoleTask=i,u=u.catch((function(e){return console.trace(e),st(e)}))),u}finally{s&&Fe()}},t.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?st(new Q.Type("Invalid argument to Table.get()")):this._trans("readonly",(function(t){return n.core.get({trans:t,key:e}).then((function(e){return n.hook.reading.fire(e)}))})).then(t)},t.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=i(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){if(e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1})).sort((function(e,t){return e.keyPath.length-t.keyPath.length}))[0];if(n&&this.db._maxKey!==lt){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map((function(t){return e[t]})))}!n&&ue&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var o=this.schema.idxByName,s=this.db._deps.indexedDB;function u(e,t){return 0===s.cmp(e,t)}var c=t.reduce((function(t,n){var r=t[0],i=t[1],s=o[n],c=e[n];return[r||s,r||!s?gt(i,s&&s.multi?function(e){var t=_(e,n);return a(t)&&t.some((function(e){return u(c,e)}))}:function(e){return u(c,_(e,n))}):i]}),[null,null]),l=c[0],f=c[1];return l?this.where(l.name).equals(e[l.keyPath]).filter(f):n?this.filter(f):this.where(t).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?"[".concat(e.join("+"),"]"):e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(t){var n=this.db,r=this.name;this.schema.mappedClass=t,t.prototype instanceof xt&&(t=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(o,t),Object.defineProperty(o.prototype,"db",{get:function(){return n},enumerable:!1,configurable:!0}),o.prototype.table=function(){return r},o}(t));for(var o=new Set,i=t.prototype;i;i=u(i))Object.getOwnPropertyNames(i).forEach((function(e){return o.add(e)}));var a=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(!o.has(r))try{n[r]=e[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=a,this.hook("reading",a),t},t.prototype.defineClass=function(){return this.mapToClass((function(e){s(this,e)}))},t.prototype.add=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,i=r.keyPath,a=e;return i&&o&&(a=wt(i)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[a]})})).then((function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult})).then((function(t){if(i)try{$(e,i,t)}catch(e){}return t}))},t.prototype.update=function(e,t){if("object"!=typeof e||a(e))return this.where(":id").equals(e).modify(t);var n=_(e,this.schema.primKey.keyPath);return void 0===n?st(new Q.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)},t.prototype.put=function(e,t){var n=this,r=this.schema.primKey,o=r.auto,i=r.keyPath,a=e;return i&&o&&(a=wt(i)(e)),this._trans("readwrite",(function(e){return n.core.mutate({trans:e,type:"put",values:[a],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?Te.reject(e.failures[0]):e.lastResult})).then((function(t){if(i)try{$(e,i,t)}catch(e){}return t}))},t.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?Te.reject(e.failures[0]):void 0}))},t.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:bt})})).then((function(e){return e.numFailures?Te.reject(e.failures[0]):void 0}))},t.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(n){return t.core.getMany({keys:e,trans:n}).then((function(e){return e.map((function(e){return t.hook.reading.fire(e)}))}))}))},t.prototype.bulkAdd=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,i=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&o)throw new Q.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=s&&a?e.map(wt(s)):e;return r.core.mutate({trans:t,type:"add",keys:o,values:c,wantResults:i}).then((function(e){var t=e.numFailures,n=e.results,o=e.lastResult,a=e.failures;if(0===t)return i?n:o;throw new W("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(u," operations failed"),a)}))}))},t.prototype.bulkPut=function(e,t,n){var r=this,o=Array.isArray(t)?t:void 0,i=(n=n||(o?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",(function(t){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&o)throw new Q.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(o&&o.length!==e.length)throw new Q.InvalidArgument("Arguments objects and keys must have the same length");var u=e.length,c=s&&a?e.map(wt(s)):e;return r.core.mutate({trans:t,type:"put",keys:o,values:c,wantResults:i}).then((function(e){var t=e.numFailures,n=e.results,o=e.lastResult,a=e.failures;if(0===t)return i?n:o;throw new W("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(u," operations failed"),a)}))}))},t.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map((function(e){return e.key})),o=e.map((function(e){return e.changes})),i=[];return this._trans("readwrite",(function(a){return n.getMany({trans:a,keys:r,cache:"clone"}).then((function(s){var u=[],c=[];e.forEach((function(e,n){var r=e.key,o=e.changes,a=s[n];if(a){for(var l=0,f=Object.keys(o);l<f.length;l++){var d=f[l],h=o[d];if(d===t.schema.primKey.keyPath){if(0!==_t(h,r))throw new Q.Constraint("Cannot update primary key in bulkUpdate()")}else $(a,d,h)}i.push(n),u.push(r),c.push(a)}}));var l=u.length;return n.mutate({trans:a,type:"put",keys:u,values:c,updates:{keys:r,changeSpecs:o}}).then((function(e){var n=e.numFailures,r=e.failures;if(0===n)return l;for(var o=0,a=Object.keys(r);o<a.length;o++){var s=a[o],u=i[Number(s)];if(null!=u){var c=r[s];delete r[s],r[u]=c}}throw new W("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(l," operations failed"),r)}))}))}))},t.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",(function(n){return t.core.mutate({trans:n,type:"delete",keys:e})})).then((function(e){var r=e.numFailures,o=e.lastResult,i=e.failures;if(0===r)return o;throw new W("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),i)}))},t}();function St(e){var t={},n=function(n,r){if(r){for(var o=arguments.length,i=new Array(o-1);--o;)i[o-1]=arguments[o];return t[n].subscribe.apply(null,i),e}if("string"==typeof n)return t[n]};n.addEventType=s;for(var r=1,o=arguments.length;r<o;++r)s(arguments[r]);return n;function s(e,r,o){if("object"!=typeof e){var u;r||(r=ae),o||(o=Z);var c={subscribers:[],fire:o,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=r(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(t){return t!==e})),c.fire=c.subscribers.reduce(r,o)}};return t[e]=n[e]=c,c}i(u=e).forEach((function(e){var t=u[e];if(a(t))s(e,u[e][0],u[e][1]);else{if("asap"!==t)throw new Q.InvalidArgument("Invalid event config");var n=s(e,ee,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){x((function(){e.apply(null,t)}))}))}))}}))}}function Pt(e,t){return p(t).from({prototype:e}),t}function Et(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ct(e,t){e.filter=gt(e.filter,t)}function Tt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return gt(r(),t())}:t,e.justLimit=n&&!r}function At(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new Q.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function jt(e,t,n){var r=At(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function Dt(e,t,n,r){var o=e.replayFilter?gt(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},a=function(e,n,r){if(!o||o(n,r,(function(e){return n.stop(e)}),(function(e){return n.fail(e)}))){var a=n.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),l(i,s)||(i[s]=!0,t(e,n,r))}};return Promise.all([e.or._iterate(a,n),Kt(jt(e,r,n),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return Kt(jt(e,r,n),gt(e.algorithm,o),t,!e.keysOnly&&e.valueMapper)}function Kt(e,t,n,r){var o=ze(r?function(e,t,o){return n(r(e),t,o)}:n);return e.then((function(e){if(e)return e.start((function(){var n=function(){return e.continue()};t&&!t(e,(function(e){return n=e}),(function(t){e.stop(t),n=Z}),(function(t){e.fail(t),n=Z}))||o(e.value,e,(function(e){return n=e})),n()}))}))}var It=Symbol(),Bt=function(){function e(e){Object.assign(this,e)}return e.prototype.execute=function(e){var t,n=null===(t=this.replacePrefix)||void 0===t?void 0:t[0];return n&&"string"==typeof e&&e.startsWith(n)?this.replacePrefix[1]+e.substring(n.length):e},e}(),Mt=function(){function e(){}return e.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,st.bind(null,n.error)):n.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,st.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=gt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Dt(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&s(n,e),t._ctx=n,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(n){return Dt(t,e,n,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var n=t._ctx,r=n.table.core;if(Et(n,!0))return r.count({trans:e,query:{index:At(n,r.schema),range:n.range}}).then((function(e){return Math.min(e,n.limit)}));var o=0;return Dt(n,(function(){return++o,!1}),e,r).then((function(){return o}))})).then(e)},e.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],o=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var a="next"===this._ctx.dir?1:-1;function s(e,t){var n=i(e,o),r=i(t,o);return n<r?-a:n>r?a:0}return this.toArray((function(e){return e.sort(s)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var n=t._ctx;if("next"===n.dir&&Et(n,!0)&&n.limit>0){var r=n.valueMapper,o=At(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then((function(e){var t=e.result;return r?t.map(r):t}))}var i=[];return Dt(n,(function(e){return i.push(e)}),e,n.table.core).then((function(){return i}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Et(t)?Tt(t,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):Tt(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Tt(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},e.prototype.until=function(e,t){return Ct(this._ctx,(function(n,r,o){return!e(n.value)||(r(o),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){return Ct(this._ctx,(function(t){return e(t.value)})),t=this._ctx,n=e,t.isMatch=gt(t.isMatch,n),this;var t,n},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Et(t,!0)&&t.limit>0)return this._read((function(e){var n=At(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.primaryKey)})).then((function(){return n})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var n={};return Ct(this._ctx,(function(e){var t=e.primaryKey.toString(),r=l(n,t);return n[t]=!0,!r})),this},e.prototype.modify=function(e){var t=this,n=this._ctx;return this._write((function(r){var o;if("function"==typeof e)o=e;else{var a=i(e),s=a.length;o=function(t){for(var n=!1,r=0;r<s;++r){var o=a[r],i=e[o],u=_(t,o);i instanceof Bt?($(t,o,i.execute(u)),n=!0):u!==i&&($(t,o,i),n=!0)}return n}}var u=n.table.core,c=u.schema.primaryKey,l=c.outbound,f=c.extractKey,d=t.db._options.modifyChunkSize||200,h=[],p=0,y=[],v=function(e,t){var n=t.failures,r=t.numFailures;p+=e-r;for(var o=0,a=i(n);o<a.length;o++){var s=a[o];h.push(n[s])}};return t.clone().primaryKeys().then((function(t){var i=function(a){var s=Math.min(d,t.length-a);return u.getMany({trans:r,keys:t.slice(a,a+s),cache:"immutable"}).then((function(c){for(var h=[],p=[],y=l?[]:null,m=[],g=0;g<s;++g){var b=c[g],w={value:A(b),primKey:t[a+g]};!1!==o.call(w,w.value,w)&&(null==w.value?m.push(t[a+g]):l||0===_t(f(b),f(w.value))?(p.push(w.value),l&&y.push(t[a+g])):(m.push(t[a+g]),h.push(w.value)))}var x=Et(n)&&n.limit===1/0&&("function"!=typeof e||e===qt)&&{index:n.index,range:n.range};return Promise.resolve(h.length>0&&u.mutate({trans:r,type:"add",values:h}).then((function(e){for(var t in e.failures)m.splice(parseInt(t),1);v(h.length,e)}))).then((function(){return(p.length>0||x&&"object"==typeof e)&&u.mutate({trans:r,type:"put",keys:y,values:p,criteria:x,changeSpec:"function"!=typeof e&&e}).then((function(e){return v(p.length,e)}))})).then((function(){return(m.length>0||x&&e===qt)&&u.mutate({trans:r,type:"delete",keys:m,criteria:x}).then((function(e){return v(m.length,e)}))})).then((function(){return t.length>a+s&&i(a+d)}))}))};return i(0).then((function(){if(h.length>0)throw new Y("Error modifying one or more objects",h,p,y);return t.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Et(e)&&(e.isPrimKey||3===t.type)?this._write((function(n){var r=e.table.core.schema.primaryKey,o=t;return e.table.core.count({trans:n,query:{index:r,range:o}}).then((function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then((function(e){var n=e.failures;e.lastResult,e.results;var r=e.numFailures;if(r)throw new Y("Could not delete some values",Object.keys(n).map((function(e){return n[e]})),t-r);return t-r}))}))})):this.modify(qt)},e}(),qt=function(e,t){return t.value=null};function Rt(e,t){return e<t?-1:e===t?0:1}function Ft(e,t){return e>t?-1:e===t?0:1}function Nt(e,t,n){var r=e instanceof Wt?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function Lt(e){return new e.Collection(e,(function(){return Yt("")})).limit(0)}function zt(e,t,n,r,o,i){for(var a=Math.min(e.length,r.length),s=-1,u=0;u<a;++u){var c=t[u];if(c!==r[u])return o(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):o(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):s>=0?e.substr(0,s)+t[s]+n.substr(s+1):null;o(e[u],c)<0&&(s=u)}return a<r.length&&"next"===i?e+n.substr(e.length):a<e.length&&"prev"===i?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}function Ht(e,t,n,r){var o,i,a,s,u,c,l,f=n.length;if(!n.every((function(e){return"string"==typeof e})))return Nt(e,ht);function d(e){o=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),i=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),a="next"===e?Rt:Ft;var t=n.map((function(e){return{lower:i(e),upper:o(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));s=t.map((function(e){return e.upper})),u=t.map((function(e){return e.lower})),c=e,l="next"===e?"":r}d("next");var h=new e.Collection(e,(function(){return Ut(s[0],u[f-1]+r)}));h._ondirectionchange=function(e){d(e)};var p=0;return h._addAlgorithm((function(e,n,r){var o=e.key;if("string"!=typeof o)return!1;var d=i(o);if(t(d,u,p))return!0;for(var h=null,y=p;y<f;++y){var v=zt(o,d,s[y],u[y],a,c);null===v&&null===h?p=y+1:(null===h||a(h,v)>0)&&(h=v)}return n(null!==h?function(){e.continue(h+l)}:r),!1})),h}function Ut(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Yt(e){return{type:1,lower:e,upper:e}}var Wt=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),e.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Lt(this):new this.Collection(this,(function(){return Ut(e,t,!n,!r)}))}catch(e){return Nt(this,dt)}},e.prototype.equals=function(e){return null==e?Nt(this,dt):new this.Collection(this,(function(){return Yt(e)}))},e.prototype.above=function(e){return null==e?Nt(this,dt):new this.Collection(this,(function(){return Ut(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?Nt(this,dt):new this.Collection(this,(function(){return Ut(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?Nt(this,dt):new this.Collection(this,(function(){return Ut(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?Nt(this,dt):new this.Collection(this,(function(){return Ut(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!=typeof e?Nt(this,ht):this.between(e,e+lt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Ht(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],lt)},e.prototype.equalsIgnoreCase=function(e){return Ht(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=R.apply(q,arguments);return 0===e.length?Lt(this):Ht(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=R.apply(q,arguments);return 0===e.length?Lt(this):Ht(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,lt)},e.prototype.anyOf=function(){var e=this,t=R.apply(q,arguments),n=this._cmp;try{t.sort(n)}catch(e){return Nt(this,dt)}if(0===t.length)return Lt(this);var r=new this.Collection(this,(function(){return Ut(t[0],t[t.length-1])}));r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var o=0;return r._addAlgorithm((function(e,r,i){for(var a=e.key;n(a,t[o])>0;)if(++o===t.length)return r(i),!1;return 0===n(a,t[o])||(r((function(){e.continue(t[o])})),!1)})),r},e.prototype.notEqual=function(e){return this.inAnyRange([[ft,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=R.apply(q,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Nt(this,dt)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[ft,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,o=this._ascending,i=this._descending,a=this._min,s=this._max;if(0===e.length)return Lt(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&o(e[0],e[1])<=0})))return Nt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Q.InvalidArgument);var u=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;var l,f=o;function d(e,t){return f(e[0],t[0])}try{(l=e.reduce((function(e,t){for(var n=0,o=e.length;n<o;++n){var i=e[n];if(r(t[0],i[1])<0&&r(t[1],i[0])>0){i[0]=a(i[0],t[0]),i[1]=s(i[1],t[1]);break}}return n===o&&e.push(t),e}),[])).sort(d)}catch(e){return Nt(this,dt)}var h=0,p=c?function(e){return o(e,l[h][1])>0}:function(e){return o(e,l[h][1])>=0},y=u?function(e){return i(e,l[h][0])>0}:function(e){return i(e,l[h][0])>=0};var v=p,m=new this.Collection(this,(function(){return Ut(l[0][0],l[l.length-1][1],!u,!c)}));return m._ondirectionchange=function(e){"next"===e?(v=p,f=o):(v=y,f=i),l.sort(d)},m._addAlgorithm((function(e,t,r){for(var i=e.key;v(i);)if(++h===l.length)return t(r),!1;return!!function(e){return!p(e)&&!y(e)}(i)||(0===n._cmp(i,l[h][1])||0===n._cmp(i,l[h][0])||t((function(){f===o?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),m},e.prototype.startsWithAnyOf=function(){var e=R.apply(q,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Lt(this):this.inAnyRange(e.map((function(e){return[e,e+lt]}))):Nt(this,"startsWithAnyOf() only works with strings")},e}();function Vt(e){return ze((function(t){return Gt(t),e(t.target.error),!1}))}function Gt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Qt="storagemutated",Xt="x-storagemutated-1",Jt=St(null,Qt),Zt=function(){function e(){}return e.prototype._lock=function(){return w(!Se.global),++this._reculock,1!==this._reculock||Se.global||(Se.lockOwnerFor=this),this},e.prototype._unlock=function(){if(w(!Se.global),0==--this._reculock)for(Se.global||(Se.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{ot(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&Se.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(w(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new Q.DatabaseClosed(r);case"MissingAPIError":throw new Q.MissingAPI(r.message,r);default:throw new Q.OpenFailed(r)}if(!this.active)throw new Q.TransactionInactive;return w(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ze((function(n){Gt(n),t._reject(e.error)})),e.onabort=ze((function(n){Gt(n),t.active&&t._reject(new Q.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=ze((function(){t.active=!1,t._resolve(),"mutatedParts"in e&&Jt.storagemutated.fire(e.mutatedParts)})),this},e.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return st(new Q.ReadOnly("Transaction is readonly"));if(!this.active)return st(new Q.TransactionInactive);if(this._locked())return new Te((function(o,i){r._blockedFuncs.push([function(){r._promise(e,t,n).then(o,i)},Se])}));if(n)return Qe((function(){var e=new Te((function(e,n){r._lock();var o=t(e,n,r);o&&o.then&&o.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var o=new Te((function(e,n){var o=t(e,n,r);o&&o.then&&o.then(e,n)}));return o._lib=!0,o},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),n=Te.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return n}));else{t._waitingFor=n,t._waitingQueue=[];var r=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(r.get(-1/0).onsuccess=e)}()}var o=t._waitingFor;return new Te((function(e,r){n.then((function(n){return t._waitingQueue.push(ze(e.bind(null,n)))}),(function(e){return t._waitingQueue.push(ze(r.bind(null,e)))})).finally((function(){t._waitingFor===o&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Q.Abort))},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];var n=this.schema[e];if(!n)throw new Q.NotFound("Table "+e+" not part of transaction");var r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),t[e]=r,r},e}();function en(e,t,n,r,o,i,a){return{name:e,keyPath:t,unique:n,multi:r,auto:o,compound:i,src:(n&&!a?"&":"")+(r?"*":"")+(o?"++":"")+tn(t)}}function tn(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function nn(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=n,o=function(e){return[e.name,e]},r.reduce((function(e,t,n){var r=o(t,n);return r&&(e[r[0]]=r[1]),e}),{}))};var r,o}var rn=function(e){try{return e.only([[]]),rn=function(){return[[]]},[[]]}catch(e){return rn=function(){return lt},lt}};function on(e){return null==e?function(){}:"string"==typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return _(t,e)}}(e):function(t){return _(t,e)}}function an(e){return[].slice.call(e)}var sn=0;function un(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function cn(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,o=e.lowerOpen,i=e.upperOpen;return void 0===n?void 0===r?null:t.upperBound(r,!!i):void 0===r?t.lowerBound(n,!!o):t.bound(n,r,!!o,!!i)}var o=function(e,t){var n=an(e.objectStoreNames);return{schema:{name:e.name,tables:n.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,n=e.autoIncrement,r=a(t),o=null==t,i={},s={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:on(t)},indexes:an(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,n=e.unique,r=e.multiEntry,o=e.keyPath,s={name:t,compound:a(o),keyPath:o,unique:n,multiEntry:r,extractKey:on(o)};return i[un(o)]=s,s})),getIndexByKeyPath:function(e){return i[un(e)]}};return i[":id"]=s.primaryKey,null!=t&&(i[un(t)]=s.primaryKey),s}))},hasGetAll:n.length>0&&"getAll"in t.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),i=o.schema,s=o.hasGetAll,u=i.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(e){var n=e.trans,o=e.type,i=e.keys,a=e.values,s=e.range;return new Promise((function(e,u){e=ze(e);var c=n.objectStore(t),l=null==c.keyPath,f="put"===o||"add"===o;if(!f&&"delete"!==o&&"deleteRange"!==o)throw new Error("Invalid operation type: "+o);var d,h=(i||a||{length:1}).length;if(i&&a&&i.length!==a.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return e({numFailures:0,failures:{},results:[],lastResult:void 0});var p=[],y=[],v=0,m=function(e){++v,Gt(e)};if("deleteRange"===o){if(4===s.type)return e({numFailures:v,failures:y,results:[],lastResult:void 0});3===s.type?p.push(d=c.clear()):p.push(d=c.delete(r(s)))}else{var g=f?l?[a,i]:[a,null]:[i,null],b=g[0],w=g[1];if(f)for(var x=0;x<h;++x)p.push(d=w&&void 0!==w[x]?c[o](b[x],w[x]):c[o](b[x])),d.onerror=m;else for(x=0;x<h;++x)p.push(d=c[o](b[x])),d.onerror=m}var _=function(t){var n=t.target.result;p.forEach((function(e,t){return null!=e.error&&(y[t]=e.error)})),e({numFailures:v,failures:y,results:"delete"===o?i:p.map((function(e){return e.result})),lastResult:n})};d.onerror=function(e){m(e),_(e)},d.onsuccess=_}))},getMany:function(e){var n=e.trans,r=e.keys;return new Promise((function(e,o){e=ze(e);for(var i,a=n.objectStore(t),s=r.length,u=new Array(s),c=0,l=0,f=function(t){var n=t.target;u[n._pos]=n.result,++l===c&&e(u)},d=Vt(o),h=0;h<s;++h)null!=r[h]&&((i=a.get(r[h]))._pos=h,i.onsuccess=f,i.onerror=d,++c);0===c&&e(u)}))},get:function(e){var n=e.trans,r=e.key;return new Promise((function(e,o){e=ze(e);var i=n.objectStore(t).get(r);i.onsuccess=function(t){return e(t.target.result)},i.onerror=Vt(o)}))},query:function(e){return function(n){return new Promise((function(o,i){o=ze(o);var a=n.trans,s=n.values,u=n.limit,c=n.query,l=u===1/0?void 0:u,f=c.index,d=c.range,h=a.objectStore(t),p=f.isPrimaryKey?h:h.index(f.name),y=r(d);if(0===u)return o({result:[]});if(e){var v=s?p.getAll(y,l):p.getAllKeys(y,l);v.onsuccess=function(e){return o({result:e.target.result})},v.onerror=Vt(i)}else{var m=0,g=s||!("openKeyCursor"in p)?p.openCursor(y):p.openKeyCursor(y),b=[];g.onsuccess=function(e){var t=g.result;return t?(b.push(s?t.value:t.primaryKey),++m===u?o({result:b}):void t.continue()):o({result:b})},g.onerror=Vt(i)}}))}}(s),openCursor:function(e){var n=e.trans,o=e.values,i=e.query,a=e.reverse,s=e.unique;return new Promise((function(e,u){e=ze(e);var c=i.index,l=i.range,f=n.objectStore(t),d=c.isPrimaryKey?f:f.index(c.name),h=a?s?"prevunique":"prev":s?"nextunique":"next",p=o||!("openKeyCursor"in d)?d.openCursor(r(l),h):d.openKeyCursor(r(l),h);p.onerror=Vt(u),p.onsuccess=ze((function(t){var r=p.result;if(r){r.___id=++sn,r.done=!1;var o=r.continue.bind(r),i=r.continuePrimaryKey;i&&(i=i.bind(r));var a=r.advance.bind(r),s=function(){throw new Error("Cursor not stopped")};r.trans=n,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=ze(u),r.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},r.start=function(e){var t=new Promise((function(e,t){e=ze(e),p.onerror=Vt(t),r.fail=t,r.stop=function(t){r.stop=r.continue=r.continuePrimaryKey=r.advance=s,e(t)}})),n=function(){if(p.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=ze((function(e){p.onsuccess=n,n()})),r.continue=o,r.continuePrimaryKey=i,r.advance=a,n(),t},e(r)}else e(null)}),u)}))},count:function(e){var n=e.query,o=e.trans,i=n.index,a=n.range;return new Promise((function(e,n){var s=o.objectStore(t),u=i.isPrimaryKey?s:s.index(i.name),c=r(a),l=c?u.count(c):u.count();l.onsuccess=ze((function(t){return e(t.target.result)})),l.onerror=Vt(n)}))}}}(e)})),c={};return u.forEach((function(e){return c[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!c[e])throw new Error("Table '".concat(e,"' not found"));return c[e]},MIN_KEY:-1/0,MAX_KEY:rn(t),schema:i}}function ln(e,n){return n.reduce((function(e,n){var r=n.create;return t(t({},e),r(e))}),e)}function fn(e,t){var n=t.db,r=function(e,t,n,r){var o=n.IDBKeyRange;return n.indexedDB,{dbcore:ln(cn(t,o,r),e.dbcore)}}(e._middlewares,n,e._deps,t);e.core=r.dbcore,e.tables.forEach((function(t){var n=t.name;e.core.schema.tables.some((function(e){return e.name===n}))&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))}))}function dn(e,t,n,r){n.forEach((function(n){var o=r[n];t.forEach((function(t){var r=v(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?h(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,o))}))}))}function hn(e,t){t.forEach((function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]}))}function pn(e,t){return e._cfg.version-t._cfg.version}function yn(e,t,n,r){var o=e._dbSchema;n.objectStoreNames.contains("$meta")&&!o.$meta&&(o.$meta=nn("$meta",_n("")[0],[]),e._storeNames.push("$meta"));var a=e._createTransaction("readwrite",e._storeNames,o);a.create(n),a._completion.catch(r);var s=a._reject.bind(a),u=Se.transless||Se;Qe((function(){if(Se.trans=a,Se.transless=u,0!==t)return fn(e,n),function(e,t,n){return t.storeNames.includes("$meta")?t.table("$meta").get("version").then((function(e){return null!=e?e:n})):Te.resolve(n)}(0,a,t).then((function(t){return function(e,t,n,r){var o=[],a=e._versions,s=e._dbSchema=wn(0,e.idbdb,r),u=a.filter((function(e){return e._cfg.version>=t}));if(0===u.length)return Te.resolve();function c(){return o.length?Te.resolve(o.shift()(n.idbtrans)).then(c):Te.resolve()}return u.forEach((function(a){o.push((function(){var o=s,u=a._cfg.dbschema;xn(e,o,r),xn(e,u,r),s=e._dbSchema=u;var c=vn(o,u);c.add.forEach((function(e){mn(r,e[0],e[1].primKey,e[1].indexes)})),c.change.forEach((function(e){if(e.recreate)throw new Q.Upgrade("Not yet support for changing primary key");var t=r.objectStore(e.name);e.add.forEach((function(e){return bn(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),bn(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var l=a._cfg.contentUpgrade;if(l&&a._cfg.version>t){fn(e,r),n._memoizedTables={};var f=k(u);c.del.forEach((function(e){f[e]=o[e]})),hn(e,[e.Transaction.prototype]),dn(e,[e.Transaction.prototype],i(f),f),n.schema=f;var d,h=F(l);h&&Xe();var p=Te.follow((function(){if((d=l(n))&&h){var e=Je.bind(null,null);d.then(e,e)}}));return d&&"function"==typeof d.then?Te.resolve(d):p.then((function(){return d}))}})),o.push((function(t){(function(e,t){[].slice.call(t.db.objectStoreNames).forEach((function(n){return null==e[n]&&t.db.deleteObjectStore(n)}))})(a._cfg.dbschema,t),hn(e,[e.Transaction.prototype]),dn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema})),o.push((function(t){e.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(e.idbdb.version/10)===a._cfg.version?(e.idbdb.deleteObjectStore("$meta"),delete e._dbSchema.$meta,e._storeNames=e._storeNames.filter((function(e){return"$meta"!==e}))):t.objectStore("$meta").put(a._cfg.version,"version"))}))})),c().then((function(){gn(s,r)}))}(e,t,a,n)})).catch(s);i(o).forEach((function(e){mn(n,e,o[e].primKey,o[e].indexes)})),fn(e,n),Te.follow((function(){return e.on.populate.fire(a)})).catch(s)}))}function vn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var o=e[n],i=t[n];if(o){var a={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(o.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||o.primKey.auto!==i.primKey.auto)a.recreate=!0,r.change.push(a);else{var s=o.idxByName,u=i.idxByName,c=void 0;for(c in s)u[c]||a.del.push(c);for(c in u){var l=s[c],f=u[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,i])}return r}function mn(e,t,n,r){var o=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){return bn(o,e)})),o}function gn(e,t){i(e).forEach((function(n){t.db.objectStoreNames.contains(n)||(ue&&console.debug("Dexie: Creating missing table",n),mn(t,n,e[n].primKey,e[n].indexes))}))}function bn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function wn(e,t,n){var r={};return g(t.objectStoreNames,0).forEach((function(e){for(var t=n.objectStore(e),o=t.keyPath,i=en(tn(o),o||"",!0,!1,!!t.autoIncrement,o&&"string"!=typeof o,!0),a=[],s=0;s<t.indexNames.length;++s){var u=t.index(t.indexNames[s]);o=u.keyPath;var c=en(u.name,o,!!u.unique,!!u.multiEntry,!1,o&&"string"!=typeof o,!1);a.push(c)}r[e]=nn(e,i,a)})),r}function xn(e,t,n){for(var r=n.db.objectStoreNames,i=0;i<r.length;++i){var a=r[i],s=n.objectStore(a);e._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var c=s.indexNames[u],l=s.index(c).keyPath,f="string"==typeof l?l:"["+g(l).join("+")+"]";if(t[a]){var d=t[a].idxByName[f];d&&(d.name=c,delete t[a].idxByName[f],t[a].idxByName[c]=d)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function _n(e){return e.split(",").map((function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return en(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(r),0===t)}))}var $n,kn=function(){function e(){}return e.prototype._parseStoresSpec=function(e,t){i(e).forEach((function(n){if(null!==e[n]){var r=_n(e[n]),o=r.shift();if(o.unique=!0,o.multi)throw new Q.Schema("Primary key cannot be multi-valued");r.forEach((function(e){if(e.auto)throw new Q.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Q.Schema("Index must have a name and cannot be an empty string")})),t[n]=nn(n,o,r)}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?s(this._cfg.storesSource,e):e;var n=t._versions,r={},o={};return n.forEach((function(e){s(r,e._cfg.storesSource),o=e._cfg.dbschema={},e._parseStoresSpec(r,o)})),t._dbSchema=o,hn(t,[t._allTables,t,t.Transaction.prototype]),dn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(o),o),t._storeNames=i(o),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=se(this._cfg.contentUpgrade||Z,e),this},e}();function On(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new pr(yt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function Sn(e){return e&&"function"==typeof e.databases}function Pn(e){return Qe((function(){return Se.letThrough=!0,e()}))}function En(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var n=function(){return indexedDB.databases().finally(t)};e=setInterval(n,100),n()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Cn(e){return!("from"in e)}var Tn=function(e,t){if(!this){var n=new Tn;return e&&"d"in e&&s(n,e),n}s(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function An(e,t,n){var r=_t(t,n);if(!isNaN(r)){if(r>0)throw RangeError();if(Cn(e))return s(e,{from:t,to:n,d:1});var o=e.l,i=e.r;if(_t(n,e.from)<0)return o?An(o,t,n):e.l={from:t,to:n,d:1,l:null,r:null},In(e);if(_t(t,e.to)>0)return i?An(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},In(e);_t(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),_t(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);var a=!e.r;o&&!e.l&&jn(e,o),i&&a&&jn(e,i)}}function jn(e,t){Cn(t)||function e(t,n){var r=n.from,o=n.to,i=n.l,a=n.r;An(t,r,o),i&&e(t,i),a&&e(t,a)}(e,t)}function Dn(e,t){var n=Kn(t),r=n.next();if(r.done)return!1;for(var o=r.value,i=Kn(e),a=i.next(o.from),s=a.value;!r.done&&!a.done;){if(_t(s.from,o.to)<=0&&_t(s.to,o.from)>=0)return!0;_t(o.from,s.from)<0?o=(r=n.next(s.from)).value:s=(a=i.next(o.from)).value}return!1}function Kn(e){var t=Cn(e)?null:{s:0,n:e};return{next:function(e){for(var n=arguments.length>0;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&_t(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||_t(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function In(e){var n,r,o=((null===(n=e.r)||void 0===n?void 0:n.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),i=o>1?"r":o<-1?"l":"";if(i){var a="r"===i?"l":"r",s=t({},e),u=e[i];e.from=u.from,e.to=u.to,e[i]=u[i],s[i]=u[a],e[a]=s,s.d=Bn(s)}e.d=Bn(e)}function Bn(e){var t=e.r,n=e.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Mn(e,t){return i(t).forEach((function(n){e[n]?jn(e[n],t[n]):e[n]=C(t[n])})),e}function qn(e,t){return e.all||t.all||Object.keys(e).some((function(n){return t[n]&&Dn(t[n],e[n])}))}f(Tn.prototype,(($n={add:function(e){return jn(this,e),this},addKey:function(e){return An(this,e,e),this},addKeys:function(e){var t=this;return e.forEach((function(e){return An(t,e,e)})),this}})[I]=function(){return Kn(this)},$n));var Rn={},Fn={},Nn=!1;function Ln(e,t){Mn(Fn,e),Nn||(Nn=!0,setTimeout((function(){Nn=!1;var e=Fn;Fn={},zn(e,!1)}),0))}function zn(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,o=Object.values(Rn);r<o.length;r++)Hn(s=o[r],e,n,t);else for(var i in e){var a=/^idb\:\/\/(.*)\/(.*)\//.exec(i);if(a){var s,u=a[1],c=a[2];(s=Rn["idb://".concat(u,"/").concat(c)])&&Hn(s,e,n,t)}}n.forEach((function(e){return e()}))}function Hn(e,t,n,r){for(var o=[],i=0,a=Object.entries(e.queries.query);i<a.length;i++){for(var s=a[i],u=s[0],c=[],l=0,f=s[1];l<f.length;l++){var d=f[l];qn(t,d.obsSet)?d.subscribers.forEach((function(e){return n.add(e)})):r&&c.push(d)}r&&o.push([u,c])}if(r)for(var h=0,p=o;h<p.length;h++){var y=p[h];u=y[0],c=y[1],e.queries.query[u]=c}}function Un(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?st(t.dbOpenError):e}));t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,o=Math.round(10*e.verno),a=!1;function s(){if(t.openCanceller!==r)throw new Q.DatabaseClosed("db.open() was cancelled")}var u=t.dbReadyResolve,c=null,l=!1,f=function(){return new Te((function(r,u){if(s(),!n)throw new Q.MissingAPI;var d=e.name,h=t.autoSchema||!o?n.open(d):n.open(d,o);if(!h)throw new Q.MissingAPI;h.onerror=Vt(u),h.onblocked=ze(e._fireOnBlocked),h.onupgradeneeded=ze((function(r){if(c=h.transaction,t.autoSchema&&!e._options.allowEmptyDB){h.onerror=Gt,c.abort(),h.result.close();var o=n.deleteDatabase(d);o.onsuccess=o.onerror=ze((function(){u(new Q.NoSuchDatabase("Database ".concat(d," doesnt exist")))}))}else{c.onerror=Vt(u);var i=r.oldVersion>Math.pow(2,62)?0:r.oldVersion;l=i<1,e.idbdb=h.result,a&&function(e,t){gn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=wn(0,e.idbdb,t);xn(e,e._dbSchema,t);for(var r=function(e){if(e.change.length||e.recreate)return console.warn("Unable to patch indexes of table ".concat(e.name," because it has changes on the type of index or primary key.")),{value:void 0};var n=t.objectStore(e.name);e.add.forEach((function(t){ue&&console.debug("Dexie upgrade patch: Creating missing index ".concat(e.name,".").concat(t.src)),bn(n,t)}))},o=0,i=vn(n,e._dbSchema).change;o<i.length;o++){var a=r(i[o]);if("object"==typeof a)return a.value}}(e,c),yn(e,i/10,c,u)}}),u),h.onsuccess=ze((function(){c=null;var n,s=e.idbdb=h.result,u=g(s.objectStoreNames);if(u.length>0)try{var p=s.transaction(1===(n=u).length?n[0]:n,"readonly");if(t.autoSchema)!function(e,t,n){e.verno=t.version/10;var r=e._dbSchema=wn(0,t,n);e._storeNames=g(t.objectStoreNames,0),dn(e,[e._allTables],i(r),r)}(e,s,p);else if(xn(e,e._dbSchema,p),!function(e,t){var n=vn(wn(0,e.idbdb,t),e._dbSchema);return!(n.add.length||n.change.some((function(e){return e.add.length||e.change.length})))}(e,p)&&!a)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),s.close(),o=s.version+1,a=!0,r(f());fn(e,p)}catch(e){}pt.push(e),s.onversionchange=ze((function(n){t.vcFired=!0,e.on("versionchange").fire(n)})),s.onclose=ze((function(t){e.on("close").fire(t)})),l&&function(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Sn(n)&&t!==yt&&On(n,r).put({name:t}).catch(Z)}(e._deps,d),r()}),u)})).catch((function(e){switch(null==e?void 0:e.name){case"UnknownError":if(t.PR1398_maxLoop>0)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),f();break;case"VersionError":if(o>0)return o=0,f()}return Te.reject(e)}))};return Te.race([r,("undefined"==typeof navigator?Te.resolve():En()).then(f)]).then((function(){return s(),t.onReadyBeingFired=[],Te.resolve(Pn((function(){return e.on.ready.fire(e.vip)}))).then((function n(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(se,Z);return t.onReadyBeingFired=[],Te.resolve(Pn((function(){return r(e.vip)}))).then(n)}}))})).finally((function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)})).catch((function(n){t.dbOpenError=n;try{c&&c.abort()}catch(e){}return r===t.openCanceller&&e._close(),st(n)})).finally((function(){t.openComplete=!0,u()})).then((function(){if(l){var t={};e.tables.forEach((function(n){n.schema.indexes.forEach((function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new Tn(-1/0,[[[]]]))})),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new Tn(-1/0,[[[]]])})),Jt(Qt).fire(t),zn(t,!0)}return e}))}function Yn(e){var t=function(t){return e.next(t)},n=o(t),r=o((function(t){return e.throw(t)}));function o(e){return function(t){var o=e(t),i=o.value;return o.done?i:i&&"function"==typeof i.then?i.then(n,r):a(i)?Promise.all(i).then(n,r):n(i)}}return o(t)()}function Wn(e,t,n){var r=arguments.length;if(r<2)throw new Q.InvalidArgument("Too few arguments");for(var o=new Array(r-1);--r;)o[r-1]=arguments[r];return n=o.pop(),[e,S(o),n]}function Vn(e,t,n,r,o){return Te.resolve().then((function(){var i=Se.transless||Se,a=e._createTransaction(t,n,e._dbSchema,r);a.explicit=!0;var s={trans:a,transless:i};if(r)a.idbtrans=r.idbtrans;else try{a.create(),a.idbtrans._explicit=!0,e._state.PR1398_maxLoop=3}catch(r){return r.name===V.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e.close({disableAutoOpen:!1}),e.open().then((function(){return Vn(e,t,n,null,o)}))):st(r)}var u,c=F(o);c&&Xe();var l=Te.follow((function(){if(u=o.call(a,a))if(c){var e=Je.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=Yn(u))}),s);return(u&&"function"==typeof u.then?Te.resolve(u).then((function(e){return a.active?e:st(new Q.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return u}))).then((function(e){return r&&a._resolve(),a._completion.then((function(){return e}))})).catch((function(e){return a._reject(e),st(e)}))}))}function Gn(e,t,n){for(var r=a(e)?e.slice():[e],o=0;o<n;++o)r.push(t);return r}var Qn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),o=r.schema,i={},a=[];function s(e,n,r){var o=un(e),u=i[o]=i[o]||[],c=null==e?0:"string"==typeof e?1:e.length,l=n>0,f=t(t({},r),{name:l?"".concat(o,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:l,keyTail:n,keyLength:c,extractKey:on(e),unique:!l&&r.unique});return u.push(f),f.isPrimaryKey||a.push(f),c>1&&s(2===c?e[0]:e.slice(0,c-1),n+1,r),u.sort((function(e,t){return e.keyTail-t.keyTail})),f}var u=s(o.primaryKey.keyPath,0,o.primaryKey);i[":id"]=[u];for(var c=0,l=o.indexes;c<l.length;c++){var f=l[c];s(f.keyPath,0,f)}function d(n){var r,o,i=n.query.index;return i.isVirtual?t(t({},n),{query:{index:i.lowLevelIndex,range:(r=n.query.range,o=i.keyTail,{type:1===r.type?2:r.type,lower:Gn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,o),lowerOpen:!0,upper:Gn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,o),upperOpen:!0})}}):n}var h=t(t({},r),{schema:t(t({},o),{primaryKey:u,indexes:a,getIndexByKeyPath:function(e){var t=i[un(e)];return t&&t[0]}}),count:function(e){return r.count(d(e))},query:function(e){return r.query(d(e))},openCursor:function(t){var n=t.query.index,o=n.keyTail,i=n.isVirtual,a=n.keyLength;if(!i)return r.openCursor(t);return r.openCursor(d(t)).then((function(n){return n&&function(n){var r=Object.create(n,{continue:{value:function(r){null!=r?n.continue(Gn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,o)):t.unique?n.continue(n.key.slice(0,a).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,o)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Gn(t,e.MAX_KEY,o),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===a?e[0]:e.slice(0,a)}},value:{get:function(){return n.value}}});return r}(n)}))}});return h}})}};function Xn(e,t,n,r){return n=n||{},r=r||"",i(e).forEach((function(o){if(l(t,o)){var i=e[o],a=t[o];if("object"==typeof i&&"object"==typeof a&&i&&a){var s=K(i);s!==K(a)?n[r+o]=t[o]:"Object"===s?Xn(i,a,n,r+o+"."):i!==a&&(n[r+o]=t[o])}else i!==a&&(n[r+o]=t[o])}else n[r+o]=void 0})),i(t).forEach((function(o){l(e,o)||(n[r+o]=t[o])})),n}function Jn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var Zn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return t(t({},e),{table:function(n){var o=e.table(n),i=o.schema.primaryKey,a=t(t({},o),{mutate:function(e){var a=Se.trans,s=a.table(n).hook,u=s.deleting,c=s.creating,f=s.updating;switch(e.type){case"add":if(c.fire===Z)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"put":if(c.fire===Z&&f.fire===Z)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"delete":if(u.fire===Z)break;return a._promise("readwrite",(function(){return d(e)}),!0);case"deleteRange":if(u.fire===Z)break;return a._promise("readwrite",(function(){return function(e){return h(e.trans,e.range,1e4)}(e)}),!0)}return o.mutate(e);function d(e){var n=Se.trans,a=e.keys||Jn(i,e);if(!a)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?t(t({},e),{keys:a}):t({},e)).type&&(e.values=r([],e.values,!0)),e.keys&&(e.keys=r([],e.keys,!0)),function(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(o,e,a).then((function(t){var r=a.map((function(r,o){var a=t[o],s={onerror:null,onsuccess:null};if("delete"===e.type)u.fire.call(s,r,a,n);else if("add"===e.type||void 0===a){var d=c.fire.call(s,r,e.values[o],n);null==r&&null!=d&&(r=d,e.keys[o]=r,i.outbound||$(e.values[o],i.keyPath,r))}else{var h=Xn(a,e.values[o]),p=f.fire.call(s,h,r,a,n);if(p){var y=e.values[o];Object.keys(p).forEach((function(e){l(y,e)?y[e]=p[e]:$(y,e,p[e])}))}}return s}));return o.mutate(e).then((function(n){for(var o=n.failures,i=n.results,s=n.numFailures,u=n.lastResult,c=0;c<a.length;++c){var l=i?i[c]:a[c],f=r[c];null==l?f.onerror&&f.onerror(o[c]):f.onsuccess&&f.onsuccess("put"===e.type&&t[c]?e.values[c]:l)}return{failures:o,results:i,numFailures:s,lastResult:u}})).catch((function(e){return r.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}function h(e,n,r){return o.query({trans:e,values:!1,query:{index:i,range:n},limit:r}).then((function(o){var i=o.result;return d({type:"delete",keys:i,trans:e}).then((function(o){return o.numFailures>0?Promise.reject(o.failures[0]):i.length<r?{failures:[],numFailures:0,lastResult:void 0}:h(e,t(t({},n),{lower:i[i.length-1],lowerOpen:!0}),r)}))}))}}});return a}})}};function er(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],o=0,i=0;o<t.keys.length&&i<e.length;++o)0===_t(t.keys[o],e[i])&&(r.push(n?A(t.values[o]):t.values[o]),++i);return r.length===e.length?r:null}catch(e){return null}}var tr={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var r=e.table(n);return t(t({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=er(e.keys,e.trans._cache,"clone"===e.cache);return t?Te.resolve(t):r.getMany(e).then((function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?A(t):t},t}))},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function nr(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function rr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var or={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,r=new Tn(e.MIN_KEY,e.MAX_KEY);return t(t({},e),{transaction:function(t,n,r){if(Se.subscr&&"readonly"!==n)throw new Q.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Se.querier));return e.transaction(t,n,r)},table:function(o){var s=e.table(o),u=s.schema,c=u.primaryKey,l=u.indexes,f=c.extractKey,d=c.outbound,h=c.autoIncrement&&l.filter((function(e){return e.compound&&e.keyPath.includes(c.keyPath)})),p=t(t({},s),{mutate:function(e){var t=e.trans,i=e.mutatedParts||(e.mutatedParts={}),l=function(e){var t="idb://".concat(n,"/").concat(o,"/").concat(e);return i[t]||(i[t]=new Tn)},f=l(""),d=l(":dels"),p=e.type,y="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[Jn(c,e).filter((function(e){return e})),e.values]:[],v=y[0],m=y[1],g=e.trans._cache;if(a(v)){f.addKeys(v);var b="delete"===p||v.length===m.length?er(v,g):null;b||d.addKeys(v),(b||m)&&function(e,t,n,r){function o(t){var o=e(t.name||"");function i(e){return null!=e?t.extractKey(e):null}var s=function(e){return t.multiEntry&&a(e)?e.forEach((function(e){return o.addKey(e)})):o.addKey(e)};(n||r).forEach((function(e,t){var o=n&&i(n[t]),a=r&&i(r[t]);0!==_t(o,a)&&(null!=o&&s(o),null!=a&&s(a))}))}t.indexes.forEach(o)}(l,u,b,m)}else if(v){var w={from:v.lower,to:v.upper};d.add(w),f.add(w)}else f.add(r),d.add(r),u.indexes.forEach((function(e){return l(e.name).add(r)}));return s.mutate(e).then((function(n){return!v||"add"!==e.type&&"put"!==e.type||(f.addKeys(n.results),h&&h.forEach((function(t){var r=e.values.map((function(e){return t.extractKey(e)})),o=t.keyPath.findIndex((function(e){return e===c.keyPath}));n.results.forEach((function(e){return r[o]=e})),l(t.name).addKeys(r)}))),t.mutatedParts=Mn(t.mutatedParts||{},i),n}))}}),y=function(t){var n,r,o=t.query,i=o.index,a=o.range;return[i,new Tn(null!==(n=a.lower)&&void 0!==n?n:e.MIN_KEY,null!==(r=a.upper)&&void 0!==r?r:e.MAX_KEY)]},v={get:function(e){return[c,new Tn(e.key)]},getMany:function(e){return[c,(new Tn).addKeys(e.keys)]},count:y,query:y,openCursor:y};return i(v).forEach((function(e){p[e]=function(i){var a=Se.subscr,u=!!a,c=nr(Se,s)&&rr(e,i)?i.obsSet={}:a;if(u){var l=function(e){var t="idb://".concat(n,"/").concat(o,"/").concat(e);return c[t]||(c[t]=new Tn)},h=l(""),p=l(":dels"),y=v[e](i),m=y[0],g=y[1];if("query"===e&&m.isPrimaryKey&&!i.values?p.add(g):l(m.name||"").add(g),!m.isPrimaryKey){if("count"!==e){var b="query"===e&&d&&i.values&&s.query(t(t({},i),{values:!1}));return s[e].apply(this,arguments).then((function(t){if("query"===e){if(d&&i.values)return b.then((function(e){var n=e.result;return h.addKeys(n),t}));var n=i.values?t.result.map(f):t.result;i.values?h.addKeys(n):p.addKeys(n)}else if("openCursor"===e){var r=t,o=i.values;return r&&Object.create(r,{key:{get:function(){return p.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return p.addKey(e),e}},value:{get:function(){return o&&h.addKey(r.primaryKey),r.value}}})}return t}))}p.add(r)}}return s[e].apply(this,arguments)}})),p}})}};function ir(e,n,r){if(0===r.numFailures)return n;if("deleteRange"===n.type)return null;var o=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;if(r.numFailures===o)return null;var i=t({},n);return a(i.keys)&&(i.keys=i.keys.filter((function(e,t){return!(t in r.failures)}))),"values"in i&&a(i.values)&&(i.values=i.values.filter((function(e,t){return!(t in r.failures)}))),i}function ar(e,t){return function(e,t){return void 0===t.lower||(t.lowerOpen?_t(e,t.lower)>0:_t(e,t.lower)>=0)}(e,t)&&function(e,t){return void 0===t.upper||(t.upperOpen?_t(e,t.upper)<0:_t(e,t.upper)<=0)}(e,t)}function sr(e,t,n,r,o,i){if(!n||0===n.length)return e;var s=t.query.index,u=s.multiEntry,c=t.query.range,l=r.schema.primaryKey.extractKey,f=s.extractKey,d=(s.lowLevelIndex||s).extractKey,h=n.reduce((function(e,n){var r=e,o="add"===n.type||"put"===n.type?n.values.filter((function(e){var t=f(e);return u&&a(t)?t.some((function(e){return ar(e,c)})):ar(t,c)})).map((function(e){return e=A(e),i&&Object.freeze(e),e})):[];switch(n.type){case"add":r=e.concat(t.values?o:o.map((function(e){return l(e)})));break;case"put":var s=(new Tn).addKeys(n.values.map((function(e){return l(e)})));r=e.filter((function(e){var n=t.values?l(e):e;return!Dn(new Tn(n),s)})).concat(t.values?o:o.map((function(e){return l(e)})));break;case"delete":var d=(new Tn).addKeys(n.keys);r=e.filter((function(e){var n=t.values?l(e):e;return!Dn(new Tn(n),d)}));break;case"deleteRange":var h=n.range;r=e.filter((function(e){return!ar(l(e),h)}))}return r}),e);return h===e?e:(h.sort((function(e,t){return _t(d(e),d(t))||_t(l(e),l(t))})),t.limit&&t.limit<1/0&&(h.length>t.limit?h.length=t.limit:e.length===t.limit&&h.length<t.limit&&(o.dirty=!0)),i?Object.freeze(h):h)}function ur(e,t){return 0===_t(e.lower,t.lower)&&0===_t(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function cr(e,t){return function(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;var o=_t(e,t);if(0===o){if(n&&r)return 0;if(n)return 1;if(r)return-1}return o}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&function(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;var o=_t(e,t);if(0===o){if(n&&r)return 0;if(n)return-1;if(r)return 1}return o}(e.upper,t.upper,e.upperOpen,t.upperOpen)>=0}function lr(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",(function(){e.subscribers.delete(n),0===e.subscribers.size&&function(e,t){setTimeout((function(){0===e.subscribers.size&&M(t,e)}),3e3)}(e,t)}))}var fr={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name,r=t(t({},e),{transaction:function(t,r,o){var i=e.transaction(t,r,o);if("readwrite"===r){var a=new AbortController,s=a.signal,u=function(o){return function(){if(a.abort(),"readwrite"===r){for(var s=new Set,u=0,c=t;u<c.length;u++){var l=c[u],f=Rn["idb://".concat(n,"/").concat(l)];if(f){var d=e.table(l),h=f.optimisticOps.filter((function(e){return e.trans===i}));if(i._explicit&&o&&i.mutatedParts)for(var p=0,y=Object.values(f.queries.query);p<y.length;p++)for(var v=0,m=(w=y[p]).slice();v<m.length;v++)qn(($=m[v]).obsSet,i.mutatedParts)&&(M(w,$),$.subscribers.forEach((function(e){return s.add(e)})));else if(h.length>0){f.optimisticOps=f.optimisticOps.filter((function(e){return e.trans!==i}));for(var g=0,b=Object.values(f.queries.query);g<b.length;g++)for(var w,x=0,_=(w=b[g]).slice();x<_.length;x++){var $;if(null!=($=_[x]).res&&i.mutatedParts)if(o&&!$.dirty){var k=Object.isFrozen($.res),O=sr($.res,$.req,h,d,$,k);$.dirty?(M(w,$),$.subscribers.forEach((function(e){return s.add(e)}))):O!==$.res&&($.res=O,$.promise=Te.resolve({result:O}))}else $.dirty&&M(w,$),$.subscribers.forEach((function(e){return s.add(e)}))}}}}s.forEach((function(e){return e()}))}}};i.addEventListener("abort",u(!1),{signal:s}),i.addEventListener("error",u(!1),{signal:s}),i.addEventListener("complete",u(!0),{signal:s})}return i},table:function(r){var o=e.table(r),i=o.schema.primaryKey,a=t(t({},o),{mutate:function(e){var a=Se.trans;if(i.outbound||"disabled"===a.db._options.cache||a.explicit)return o.mutate(e);var s=Rn["idb://".concat(n,"/").concat(r)];if(!s)return o.mutate(e);var u=o.mutate(e);return"add"!==e.type&&"put"!==e.type||!(e.values.length>=50||Jn(i,e).some((function(e){return null==e})))?(s.optimisticOps.push(e),e.mutatedParts&&Ln(e.mutatedParts),u.then((function(t){if(t.numFailures>0){M(s.optimisticOps,e);var n=ir(0,e,t);n&&s.optimisticOps.push(n),e.mutatedParts&&Ln(e.mutatedParts)}})),u.catch((function(){M(s.optimisticOps,e),e.mutatedParts&&Ln(e.mutatedParts)}))):u.then((function(n){var r=t(t({},e),{values:e.values.map((function(e,r){var o,a=(null===(o=i.keyPath)||void 0===o?void 0:o.includes("."))?A(e):t({},e);return $(a,i.keyPath,n.results[r]),a}))}),o=ir(0,r,n);s.optimisticOps.push(o),queueMicrotask((function(){return e.mutatedParts&&Ln(e.mutatedParts)}))})),u},query:function(e){var t;if(!nr(Se,o)||!rr("query",e))return o.query(e);var i="immutable"===(null===(t=Se.trans)||void 0===t?void 0:t.db._options.cache),a=Se,s=a.requery,u=a.signal,c=function(e,t,n,r){var o=Rn["idb://".concat(e,"/").concat(t)];if(!o)return[];var i=o.queries[n];if(!i)return[null,!1,o,null];var a=i[(r.query?r.query.index.name:null)||""];if(!a)return[null,!1,o,null];switch(n){case"query":var s=a.find((function(e){return e.req.limit===r.limit&&e.req.values===r.values&&ur(e.req.query.range,r.query.range)}));return s?[s,!0,o,a]:[a.find((function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&cr(e.req.query.range,r.query.range)})),!1,o,a];case"count":var u=a.find((function(e){return ur(e.req.query.range,r.query.range)}));return[u,!!u,o,a]}}(n,r,"query",e),l=c[0],f=c[1],d=c[2],h=c[3];if(l&&f)l.obsSet=e.obsSet;else{var p=o.query(e).then((function(e){var t=e.result;if(l&&(l.res=t),i){for(var n=0,r=t.length;n<r;++n)Object.freeze(t[n]);Object.freeze(t)}else e.result=A(t);return e})).catch((function(e){return h&&l&&M(h,l),Promise.reject(e)}));l={obsSet:e.obsSet,promise:p,subscribers:new Set,type:"query",req:e,dirty:!1},h?h.push(l):(h=[l],d||(d=Rn["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}),d.queries.query[e.query.index.name||""]=h)}return lr(l,h,s,u),l.promise.then((function(t){return{result:sr(t.result,e,null==d?void 0:d.optimisticOps,o,l,i)}}))}});return a}});return r}};function dr(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var hr,pr=function(){function e(n,r){var o=this;this._middlewares={},this.verno=0;var i=e.dependencies;this._options=r=t({addons:e.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:"cloned"},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var a=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var s,u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Z,dbReadyPromise:null,cancelOpen:Z,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:r.autoOpen};u.dbReadyPromise=new Te((function(e){u.dbReadyResolve=e})),u.openCanceller=new Te((function(e,t){u.cancelOpen=t})),this._state=u,this.name=n,this.on=St(this,"populate","blocked","versionchange","close",{ready:[se,Z]}),this.on.ready.subscribe=b(this.on.ready.subscribe,(function(t){return function(n,r){e.vip((function(){var e=o._state;if(e.openComplete)e.dbOpenError||Te.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var i=o;r||t((function e(){i.on.ready.unsubscribe(n),i.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(s=this,Pt(Mt.prototype,(function(e,t){this.db=s;var n=bt,r=null;if(t)try{n=t()}catch(e){r=e}var o=e._ctx,i=o.table,a=i.hook.reading.fire;this._ctx={table:i,index:o.index,isPrimKey:!o.index||i.schema.primKey.keyPath&&o.index===i.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:o.or,valueMapper:a!==ee?a:null}}))),this.Table=function(e){return Pt(Ot.prototype,(function(t,n,r){this.db=e,this._tx=r,this.name=t,this.schema=n,this.hook=e._allTables[t]?e._allTables[t].hook:St(null,{creating:[re,Z],reading:[te,ee],updating:[ie,Z],deleting:[oe,Z]})}))}(this),this.Transaction=function(e){return Pt(Zt.prototype,(function(t,n,r,o,i){var a=this;this.db=e,this.mode=t,this.storeNames=n,this.schema=r,this.chromeTransactionDurability=o,this.idbtrans=null,this.on=St(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Te((function(e,t){a._resolve=e,a._reject=t})),this._completion.then((function(){a.active=!1,a.on.complete.fire()}),(function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),st(e)}))}))}(this),this.Version=function(e){return Pt(kn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Pt(Wt.prototype,(function(t,n,r){if(this.db=e,this._ctx={table:t,index:":id"===n?null:n,or:r},this._cmp=this._ascending=_t,this._descending=function(e,t){return _t(t,e)},this._max=function(e,t){return _t(e,t)>0?e:t},this._min=function(e,t){return _t(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange,!this._IDBKeyRange)throw new Q.MissingAPI}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '".concat(o.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(o.name,"'. Closing db now to resume the delete request.")),o.close({disableAutoOpen:!1})})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('".concat(o.name,"') was blocked")):console.warn("Upgrade '".concat(o.name,"' blocked by other connection holding version ").concat(e.oldVersion/10))})),this._maxKey=rn(r.IDBKeyRange),this._createTransaction=function(e,t,n,r){return new o.Transaction(e,t,n,o._options.chromeTransactionDurability,r)},this._fireOnBlocked=function(e){o.on("blocked").fire(e),pt.filter((function(e){return e.name===o.name&&e!==o&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(tr),this.use(fr),this.use(or),this.use(Qn),this.use(Zn);var c=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return dr(o.table(e),c)};var r=Reflect.get(e,t,n);return r instanceof Ot?dr(r,c):"tables"===t?r.map((function(e){return dr(e,c)})):"_createTransaction"===t?function(){return dr(r.apply(this,arguments),c)}:r}});this.vip=c,a.forEach((function(e){return e(o)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new Q.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Q.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter((function(t){return t._cfg.version===e}))[0];return n||(n=new this.Version(e),t.push(n),t.sort(pn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||Se.letThrough||this._vip)?e():new Te((function(e,n){if(t._state.openComplete)return n(new Q.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new Q.DatabaseClosed);t.open().catch(Z)}t._state.dbReadyPromise.then(e,n)})).then(e)},e.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,o=e.name;o&&this.unuse({stack:t,name:o});var i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:n,level:null==r?10:r,name:o}),i.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return r?e.create!==r:!!n&&e.name!==n}))),this},e.prototype.open=function(){var e=this;return ot(Oe,(function(){return Un(e)}))},e.prototype._close=function(){var e=this._state,t=pt.indexOf(this);if(t>=0&&pt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new Te((function(t){e.dbReadyResolve=t})),e.openCanceller=new Te((function(t,n){e.cancelOpen=n})))},e.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new Q.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new Q.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},e.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=arguments.length>0&&"object"!=typeof arguments[0],r=this._state;return new Te((function(o,i){var a=function(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=ze((function(){(function(e,t){var n=e.indexedDB,r=e.IDBKeyRange;!Sn(n)&&t!==yt&&On(n,r).delete(t).catch(Z)})(t._deps,t.name),o()})),n.onerror=Vt(i),n.onblocked=t._fireOnBlocked};if(n)throw new Q.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(a):a()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return i(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!1,configurable:!0}),e.prototype.transaction=function(){var e=Wn.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,n){var r=this,o=Se.trans;o&&o.db===this&&-1===e.indexOf("!")||(o=null);var i,a,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(a=t.map((function(e){var t=e instanceof r.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||e===vt)i=vt;else{if("rw"!=e&&e!=mt)throw new Q.InvalidArgument("Invalid transaction mode: "+e);i=mt}if(o){if(o.mode===vt&&i===mt){if(!s)throw new Q.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");o=null}o&&a.forEach((function(e){if(o&&-1===o.storeNames.indexOf(e)){if(!s)throw new Q.SubTransaction("Table "+e+" not included in parent transaction.");o=null}})),s&&o&&!o.active&&(o=null)}}catch(e){return o?o._promise(null,(function(t,n){n(e)})):st(e)}var u=Vn.bind(null,this,i,a,o,n);return o?o._promise(i,u,"lock"):Se.trans?ot(Se.transless,(function(){return r._whenReady(u)})):this._whenReady(u)},e.prototype.table=function(e){if(!l(this._allTables,e))throw new Q.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},e}(),yr="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable",vr=function(){function e(e){this._subscribe=e}return e.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},e.prototype[yr]=function(){return this},e}();try{hr={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch(e){hr={indexedDB:null,IDBKeyRange:null}}function mr(e){var t,n=!1,r=new vr((function(r){var o=F(e);var i,a=!1,s={},u={},c={get closed(){return a},unsubscribe:function(){a||(a=!0,i&&i.abort(),f&&Jt.storagemutated.unsubscribe(h))}};r.start&&r.start(c);var f=!1,d=function(){return at(p)};var h=function(e){Mn(s,e),qn(u,s)&&d()},p=function(){if(!a&&hr.indexedDB){s={};var c={};i&&i.abort(),i=new AbortController;var p={subscr:c,signal:i.signal,requery:d,querier:e,trans:null},y=function(t){var n=Re();try{o&&Xe();var r=Qe(e,t);return o&&(r=r.finally(Je)),r}finally{n&&Fe()}}(p);Promise.resolve(y).then((function(e){n=!0,t=e,a||p.signal.aborted||(s={},function(e){for(var t in e)if(l(e,t))return!1;return!0}(u=c)||f||(Jt(Qt,h),f=!0),at((function(){return!a&&r.next&&r.next(e)})))}),(function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||a||at((function(){a||r.error&&r.error(e)}))}))}};return setTimeout(d,0),c}));return r.hasValue=function(){return n},r.getValue=function(){return t},r}var gr=pr;function br(e){var t=xr;try{xr=!0,Jt.storagemutated.fire(e),zn(e,!0)}finally{xr=t}}f(gr,t(t({},J),{delete:function(e){return new gr(e,{addons:[]}).delete()},exists:function(e){return new gr(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){try{return function(e){var t=e.indexedDB,n=e.IDBKeyRange;return Sn(t)?Promise.resolve(t.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return e!==yt}))})):On(t,n).toCollection().primaryKeys()}(gr.dependencies).then(e)}catch(e){return st(new Q.MissingAPI)}},defineClass:function(){return function(e){s(this,e)}},ignoreTransaction:function(e){return Se.trans?ot(Se.transless,e):e()},vip:Pn,async:function(e){return function(){try{var t=Yn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Te.resolve(t)}catch(e){return st(e)}}},spawn:function(e,t,n){try{var r=Yn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Te.resolve(r)}catch(e){return st(e)}},currentTransaction:{get:function(){return Se.trans||null}},waitFor:function(e,t){var n=Te.resolve("function"==typeof e?gr.ignoreTransaction(e):e).timeout(t||6e4);return Se.trans?Se.trans.waitFor(n):n},Promise:Te,debug:{get:function(){return ue},set:function(e){ce(e)}},derive:p,extend:s,props:f,override:b,Events:St,on:Jt,liveQuery:mr,extendObservabilitySet:Mn,getByKeyPath:_,setByKeyPath:$,delByKeyPath:function(e,t){"string"==typeof t?$(e,t,void 0):"length"in t&&[].map.call(t,(function(t){$(e,t,void 0)}))},shallowClone:k,deepClone:A,getObjectDiff:Xn,cmp:_t,asap:x,minKey:ft,addons:[],connections:pt,errnames:V,dependencies:hr,cache:Rn,semVer:ct,version:ct.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)}))})),gr.maxKey=rn(gr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(Jt(Qt,(function(e){var t;xr||(t=new CustomEvent(Xt,{detail:e}),xr=!0,dispatchEvent(t),xr=!1)})),addEventListener(Xt,(function(e){var t=e.detail;xr||br(t)})));var wr,xr=!1,_r=function(){};return"undefined"!=typeof BroadcastChannel&&((_r=function(){(wr=new BroadcastChannel(Xt)).onmessage=function(e){return e.data&&br(e.data)}})(),"function"==typeof wr.unref&&wr.unref(),Jt(Qt,(function(e){xr||wr.postMessage(e)}))),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",(function(e){if(!pr.disableBfCache&&e.persisted){ue&&console.debug("Dexie: handling persisted pagehide"),null==wr||wr.close();for(var t=0,n=pt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}})),addEventListener("pageshow",(function(e){!pr.disableBfCache&&e.persisted&&(ue&&console.debug("Dexie: handling persisted pageshow"),_r(),br({all:new Tn(-1/0,[[]])}))}))),Te.rejectionMapper=function(e,t){if(!e||e instanceof H||e instanceof TypeError||e instanceof SyntaxError||!e.name||!X[e.name])return e;var n=new X[e.name](t||e.message,e);return"stack"in e&&h(n,"stack",{get:function(){return this.inner.stack}}),n},ce(ue),t(pr,Object.freeze({__proto__:null,Dexie:pr,liveQuery:mr,Entity:xt,cmp:_t,PropModSymbol:It,PropModification:Bt,replacePrefix:function(e,t){return new Bt({replacePrefix:[e,t]})},default:pr,RangeSet:Tn,mergeRanges:jn,rangesOverlap:Dn}),{default:pr}),pr}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{"use strict";function e(){}const t=e=>e;function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function a(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(t,...n){if(null==t){for(const e of n)e(void 0);return e}const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function c(e){let t;return u(e,(e=>t=e))(),t}function l(e,t,n){e.$$.on_destroy.push(u(t,n))}function f(e,t,n,r){return e[1]&&r?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](r(t))):n.ctx}const d="undefined"!=typeof window;let h=d?()=>window.performance.now():()=>Date.now(),p=d?e=>requestAnimationFrame(e):e;const y=new Set;function v(e){y.forEach((t=>{t.c(e)||(y.delete(t),t.f())})),0!==y.size&&p(v)}function m(e){let t;return 0===y.size&&p(v),{promise:new Promise((n=>{y.add(t={c:e,f:n})})),abort(){y.delete(t)}}}const g="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;class b{_listeners="WeakMap"in g?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver((e=>{for(const t of e)b.entries.set(t.target,t),this._listeners.get(t.target)?.(t)})))}}b.entries="WeakMap"in g?new WeakMap:void 0;let w,x=!1;function _(e,t){e.appendChild(t)}function $(e,t,n){const r=k(e);if(!r.getElementById(t)){const e=T("style");e.id=t,e.textContent=n,S(r,e)}}function k(e){if(!e)return document;const t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function O(e){const t=T("style");return t.textContent="/* empty */",S(k(e),t),t.sheet}function S(e,t){return _(e.head||e,t),t.sheet}function P(e,t,n){e.insertBefore(t,n||null)}function E(e){e.parentNode&&e.parentNode.removeChild(e)}function C(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function T(e){return document.createElement(e)}function A(e){return document.createTextNode(e)}function j(){return A(" ")}function D(){return A("")}function K(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function I(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function B(e,t){t=""+t,e.data!==t&&(e.data=t)}function M(e,t){e.value=null==t?"":t}function q(e,t,n,r){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function R(){if(void 0===w){w=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(e){w=!0}}return w}function F(e,t){"static"===getComputedStyle(e).position&&(e.style.position="relative");const n=T("iframe");n.setAttribute("style","display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;"),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const r=R();let o;return r?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",o=K(window,"message",(e=>{e.source===n.contentWindow&&t()}))):(n.src="about:blank",n.onload=()=>{o=K(n.contentWindow,"resize",t),t()}),_(e,n),()=>{(r||o&&n.contentWindow)&&o(),E(n)}}function N(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function L(e,t){return new e(t)}const z=new Map;let H,U=0;function Y(e,t,n,r,o,i,a,s=0){const u=16.666/r;let c="{\n";for(let e=0;e<=1;e+=u){const r=t+(n-t)*i(e);c+=100*e+`%{${a(r,1-r)}}\n`}const l=c+`100% {${a(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(l)}_${s}`,d=k(e),{stylesheet:h,rules:p}=z.get(d)||function(e,t){const n={stylesheet:O(t),rules:{}};return z.set(e,n),n}(d,e);p[f]||(p[f]=!0,h.insertRule(`@keyframes ${f} ${l}`,h.cssRules.length));const y=e.style.animation||"";return e.style.animation=`${y?`${y}, `:""}${f} ${r}ms linear ${o}ms 1 both`,U+=1,f}function W(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),U-=o,U||p((()=>{U||(z.forEach((e=>{const{ownerNode:t}=e.stylesheet;t&&E(t)})),z.clear())})))}function V(e){H=e}function G(){if(!H)throw new Error("Function called outside component initialization");return H}function Q(e){G().$$.on_mount.push(e)}function X(e){G().$$.on_destroy.push(e)}const J=[],Z=[];let ee=[];const te=[],ne=Promise.resolve();let re=!1;function oe(e){ee.push(e)}const ie=new Set;let ae,se=0;function ue(){if(0!==se)return;const e=H;do{try{for(;se<J.length;){const e=J[se];se++,V(e),ce(e.$$)}}catch(e){throw J.length=0,se=0,e}for(V(null),J.length=0,se=0;Z.length;)Z.pop()();for(let e=0;e<ee.length;e+=1){const t=ee[e];ie.has(t)||(ie.add(t),t())}ee.length=0}while(J.length);for(;te.length;)te.pop()();re=!1,ie.clear(),V(e)}function ce(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(oe)}}function le(){return ae||(ae=Promise.resolve(),ae.then((()=>{ae=null}))),ae}function fe(e,t,n){e.dispatchEvent(N(`${t?"intro":"outro"}${n}`))}const de=new Set;let he;function pe(){he={r:0,c:[],p:he}}function ye(){he.r||i(he.c),he=he.p}function ve(e,t){e&&e.i&&(de.delete(e),e.i(t))}function me(e,t,n,r){if(e&&e.o){if(de.has(e))return;de.add(e),he.c.push((()=>{de.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}else r&&r()}const ge={duration:0};function be(n,r,o){const i={direction:"in"};let s,u,c=r(n,o,i),l=!1,f=0;function d(){s&&W(n,s)}function p(){const{delay:r=0,duration:o=300,easing:i=t,tick:a=e,css:p}=c||ge;p&&(s=Y(n,0,1,o,r,i,p,f++)),a(0,1);const y=h()+r,v=y+o;u&&u.abort(),l=!0,oe((()=>fe(n,!0,"start"))),u=m((e=>{if(l){if(e>=v)return a(1,0),fe(n,!0,"end"),d(),l=!1;if(e>=y){const t=i((e-y)/o);a(t,1-t)}}return l}))}let y=!1;return{start(){y||(y=!0,W(n),a(c)?(c=c(i),le().then(p)):p())},invalidate(){y=!1},end(){l&&(d(),l=!1)}}}function we(n,r,o){const s={direction:"out"};let u,c=r(n,o,s),l=!0;const f=he;let d;function p(){const{delay:r=0,duration:o=300,easing:a=t,tick:s=e,css:p}=c||ge;p&&(u=Y(n,1,0,o,r,a,p));const y=h()+r,v=y+o;oe((()=>fe(n,!1,"start"))),"inert"in n&&(d=n.inert,n.inert=!0),m((e=>{if(l){if(e>=v)return s(0,1),fe(n,!1,"end"),--f.r||i(f.c),!1;if(e>=y){const t=a((e-y)/o);s(1-t,t)}}return l}))}return f.r+=1,a(c)?le().then((()=>{c=c(s),p()})):p(),{end(e){e&&"inert"in n&&(n.inert=d),e&&c.tick&&c.tick(1,0),l&&(u&&W(n,u),l=!1)}}}function xe(n,r,o,s){let u,c=r(n,o,{direction:"both"}),l=s?0:1,f=null,d=null,p=null;function y(){p&&W(n,p)}function v(e,t){const n=e.b-l;return t*=Math.abs(n),{a:l,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function g(r){const{delay:o=0,duration:a=300,easing:s=t,tick:g=e,css:b}=c||ge,w={start:h()+o,b:r};r||(w.group=he,he.r+=1),"inert"in n&&(r?void 0!==u&&(n.inert=u):(u=n.inert,n.inert=!0)),f||d?d=w:(b&&(y(),p=Y(n,l,r,a,o,s,b)),r&&g(0,1),f=v(w,a),oe((()=>fe(n,r,"start"))),m((e=>{if(d&&e>d.start&&(f=v(d,a),d=null,fe(n,f.b,"start"),b&&(y(),p=Y(n,l,f.b,f.duration,0,s,c.css))),f)if(e>=f.end)g(l=f.b,1-l),fe(n,f.b,"end"),d||(f.b?y():--f.group.r||i(f.group.c)),f=null;else if(e>=f.start){const t=e-f.start;l=f.a+f.d*s(t/f.duration),g(l,1-l)}return!(!f&&!d)})))}return{run(e){a(c)?le().then((()=>{c=c({direction:e?"in":"out"}),g(e)})):g(e)},end(){y(),f=d=null}}}function _e(e){return void 0!==e?.length?e:Array.from(e)}function $e(e,t){me(e,1,1,(()=>{t.delete(e.key)}))}let ke;function Oe(e){e&&e.c()}function Se(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),oe((()=>{const t=e.$$.on_mount.map(r).filter(a);e.$$.on_destroy?e.$$.on_destroy.push(...t):i(t),e.$$.on_mount=[]})),s.forEach(oe)}function Pe(e,t){const n=e.$$;null!==n.fragment&&(function(e){const t=[],n=[];ee.forEach((r=>-1===e.indexOf(r)?t.push(r):n.push(r))),n.forEach((e=>e())),ee=t}(n.after_update),i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ee(t,n,r,a,s,u,c=null,l=[-1]){const f=H;V(t);const d=t.$$={fragment:null,ctx:[],props:u,update:e,not_equal:s,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(f?f.$$.context:[])),callbacks:o(),dirty:l,skip_bound:!1,root:n.target||f.$$.root};c&&c(d.root);let h=!1;if(d.ctx=r?r(t,n.props||{},((e,n,...r)=>{const o=r.length?r[0]:n;return d.ctx&&s(d.ctx[e],d.ctx[e]=o)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](o),h&&function(e,t){-1===e.$$.dirty[0]&&(J.push(e),re||(re=!0,ne.then(ue)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],d.update(),h=!0,i(d.before_update),d.fragment=!!a&&a(d.ctx),n.target){if(n.hydrate){x=!0;const e=(p=n.target,Array.from(p.childNodes));d.fragment&&d.fragment.l(e),e.forEach(E)}else d.fragment&&d.fragment.c();n.intro&&ve(t.$$.fragment),Se(t,n.target,n.anchor),x=!1,ue()}var p;V(f)}function Ce(e,t,n,r){const o=n[e]?.type;if(t="Boolean"===o&&"boolean"!=typeof t?null!=t:t,!r||!n[e])return t;if("toAttribute"===r)switch(o){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return null==t?null:t;default:return t}else switch(o){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}function Te(e,t,n,r,o,i){let a=class extends ke{constructor(){super(e,n,o),this.$$p_d=t}static get observedAttributes(){return Object.keys(t).map((e=>(t[e].attribute||e).toLowerCase()))}};return Object.keys(t).forEach((e=>{Object.defineProperty(a.prototype,e,{get(){return this.$$c&&e in this.$$c?this.$$c[e]:this.$$d[e]},set(n){n=Ce(e,n,t),this.$$d[e]=n,this.$$c?.$set({[e]:n})}})})),r.forEach((e=>{Object.defineProperty(a.prototype,e,{get(){return this.$$c?.[e]}})})),i&&(a=i(a)),e.element=a,a}new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(ke=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,n){super(),this.$$ctor=e,this.$$s=t,n&&this.attachShadow({mode:"open"})}addEventListener(e,t,n){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){const n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,n)}removeEventListener(e,t,n){if(super.removeEventListener(e,t,n),this.$$c){const e=this.$$l_u.get(t);e&&(e(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){if(await Promise.resolve(),!this.$$cn||this.$$c)return;function e(e){return()=>{let t;return{c:function(){t=T("slot"),"default"!==e&&I(t,"name",e)},m:function(e,n){P(e,t,n)},d:function(e){e&&E(t)}}}}const t={},n=function(e){const t={};return e.childNodes.forEach((e=>{t[e.slot||"default"]=!0})),t}(this);for(const o of this.$$s)o in n&&(t[o]=[e(o)]);for(const i of this.attributes){const a=this.$$g_p(i.name);a in this.$$d||(this.$$d[a]=Ce(a,i.value,this.$$p_d,"toProp"))}for(const s in this.$$p_d)s in this.$$d||void 0===this[s]||(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});const r=()=>{this.$$r=!0;for(const e in this.$$p_d)if(this.$$d[e]=this.$$c.$$.ctx[this.$$c.$$.props[e]],this.$$p_d[e].reflect){const t=Ce(e,this.$$d[e],this.$$p_d,"toAttribute");null==t?this.removeAttribute(this.$$p_d[e].attribute||e):this.setAttribute(this.$$p_d[e].attribute||e,t)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(const u in this.$$l)for(const c of this.$$l[u]){const l=this.$$c.$on(u,c);this.$$l_u.set(c,l)}this.$$l={}}}attributeChangedCallback(e,t,n){this.$$r||(e=this.$$g_p(e),this.$$d[e]=Ce(e,n,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then((()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)}))}$$g_p(e){return Object.keys(this.$$p_d).find((t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e))||e}});class Ae{$$=void 0;$$set=void 0;$destroy(){Pe(this,1),this.$destroy=e}$on(t,n){if(!a(n))return e;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const e=r.indexOf(n);-1!==e&&r.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const je=[];function De(e,t){return{subscribe:Ke(e,t).subscribe}}function Ke(t,n=e){let r;const o=new Set;function i(e){if(s(t,e)&&(t=e,r)){const e=!je.length;for(const e of o)e[1](),je.push(e,t);if(e){for(let e=0;e<je.length;e+=2)je[e][0](je[e+1]);je.length=0}}}function a(e){i(e(t))}return{set:i,update:a,subscribe:function(s,u=e){const c=[s,u];return o.add(c),1===o.size&&(r=n(i,a)||e),s(t),()=>{o.delete(c),0===o.size&&r&&(r(),r=null)}}}}function Ie(t,n,r){const o=!Array.isArray(t),s=o?[t]:t;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const c=n.length<2;return De(r,((t,r)=>{let l=!1;const f=[];let d=0,h=e;const p=()=>{if(d)return;h();const i=n(o?f[0]:f,t,r);c?t(i):h=a(i)?i:e},y=s.map(((e,t)=>u(e,(e=>{f[t]=e,d&=~(1<<t),l&&p()}),(()=>{d|=1<<t}))));return l=!0,p(),function(){i(y),h(),l=!1}}))}class Be{static config=new Be;visitedLinks="save";userSavable=Ke(!0);autosave=!1;sessionSave=!0;autoload=!0;historyLimit=50;userNavigable=Ke(!0);constructor(){}}const Me=Be.config;function qe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne.serializeHooks,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;switch(typeof e){case"string":case"number":case"boolean":return e;case"bigint":return{$:"b",v:"0x"+e.toString(16)};case"symbol":case"undefined":case"function":return;case"object":if(null===e)return null;if(e instanceof Array)return e.map((e=>qe(e,t)));if(e instanceof Map)return{$:"m",v:Array.of(e.entries()).map((e=>{let[n,r]=e;return[qe(n,t),qe(r,t)]}))};if(Object.hasOwn(e,"subscribe")){let n="r";return Object.hasOwn(e,"set")&&(n="w"),{$:n,v:qe(c(e),t)}}{let r=Object.getPrototypeOf(e),o=t.get(r);if(o&&r!==n){let[n,i]=o;return{$:n,v:qe(i(e),t,r)}}return{$:"o",v:Object.fromEntries(Object.entries(e).map((e=>{let[n,r]=e;return[n,qe(r,t)]})))}}}}function Re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne.deserializeHooks;switch(typeof e){case"string":case"number":case"boolean":return e;case"object":if(null===e)return null;if(e instanceof Array)return e.map((e=>Re(e,t)));let n=e.$;switch(n){case"r":return De(e.v);case"w":return Ke(e.v);case"m":return new Map(e.v.map((e=>{let[n,r]=e;return[Re(n,t),Re(r,t)]})));case"o":return Object.fromEntries(Object.entries(e.v).map((e=>{let[n,r]=e;return[n,Re(r,t)]})));case"b":return BigInt(e.v)}let r=t.get(n);return r?r(Re(e.v,t)):void 0}}class Fe{static saveManager=new Fe;callbacks=[];serializeHooks=new Map;deserializeHooks=new Map;constructor(){}serializeData(){let e=[];for(let t of this.callbacks)e.push([t.tag,qe(t.onSave(),this.serializeHooks)]);return JSON.stringify(Object.fromEntries(e))}loadData(e){let t=JSON.parse(e);for(let e of this.callbacks)e.onLoad(Re(t[e.tag],this.deserializeHooks))}}const Ne=Fe.saveManager;var Le=n(197);const ze=Symbol.for("Dexie"),He=globalThis[ze]||(globalThis[ze]=Le);if(Le.semVer!==He.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Le.semVer} and ${He.semVer}`);const{liveQuery:Ue,mergeRanges:Ye,rangesOverlap:We,RangeSet:Ve,cmp:Ge,Entity:Qe,PropModSymbol:Xe,PropModification:Je,replacePrefix:Ze}=He,et=He;class tt extends et{constructor(e){super(e,{cache:"disabled"}),this.version(1).stores({saves:"slot, name, date"})}get(e){return this.saves.get(e)}getSaves(){return this.saves.orderBy("slot").toArray()}newSave(e){return this.transaction("rw",[this.saves],(async()=>{e.slot=(await this.saves.toArray()).map((e=>e.slot)).reduce(((e,t)=>Math.max(e,t)),-1)+1,await this.saves.add(e,e.slot)}))}removeAt(e){this.saves.delete(e)}}const nt=" theme";function rt(e){document.documentElement.style.cssText=`--background-color: ${e.background}; --text-color: ${e.text}; --ui-primary-color: ${e.uiPrimary}; --ui-secondary-color: ${e.uiSecondary}; --link-color: ${e.link}; --link-visited-color: ${e.linkVisited};`}const ot=BigInt(4294967295);function it(e,t){let n=e<<BigInt(t);return n+((n&~ot)>>32n)}function at(e,t){return(e+t)%BigInt(2**32)}class st{constructor(e){if(!e){e=0n;for(let t=0;t<128;t++)Math.random()<.5&&(e|=1n),e<<=1n}e<0n&&(e=-e),this.state=e}s(e){return this.state>>BigInt(32*e)&ot}nextU32(){let e=at(it(at(this.s(0),this.s(3)),7),this.s(0)),t=this.s(1)<<9n,n=(this.s(2)^this.s(0))%BigInt(2**32),r=(this.s(3)^this.s(1))%BigInt(2**32),o=(this.s(1)^n)%BigInt(2**32),i=(this.s(0)^r)%BigInt(2**32);return n=(n^t)%BigInt(2**32),r=it(r,11),this.state=i+(o<<32n)+(n<<64n)+(r<<96n),Number(BigInt.asUintN(32,e))}nextFloat(e,t){return e||(e=0),t||(t=1),this.nextU32()/2**32*(t-e)+e}nextInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(this.nextU32()%(t-e)+e)}nextBool(){return 1==this.nextInt(0,2)}choose(e){let t=this.nextFloat();for(let n=0;n<e.length;n++){if(t<e[n])return n;t-=e[n]}return 0}serialize(){return"0x"+this.state.toString(16)}static deserialize(e){return new st(BigInt(e))}}class ut{constructor(e,t,n,r){this.name=e,this.tags=t,this.meta=n,this.component=r}}class ct{constructor(e,t){this.passage=e,this.locals=t}}class lt{constructor(e,t){this.moments=e,this.currentIndex=t}moments=[];currentIndex=0}class ft{static engine=new ft;_passages=[];_passagesByName=new Map;history=Ke(new lt([],0));onReset=[];loading=Ke(!1);get locals(){let e=c(this.history);return e.moments[e.currentIndex].locals}globals={};visitedPassages=Ke([]);version=0;constructor(){this.title=Ke(document.title),this.staticTitle=document.title,this.saveDB=new tt(this.staticTitle),this.title.subscribe((e=>{document.title=e})),this.currentPassage=Ie(this.history,(e=>this._passagesByName.get(e.moments[e.currentIndex].passage))),Ne.serializeHooks.set(lt.prototype,["iff.engine.History",e=>e]),Ne.serializeHooks.set(ct.prototype,["iff.engine.Moment",e=>e]),Ne.deserializeHooks.set("iff.engine.History",(e=>{let t=e;return new lt(t.moments,t.currentIndex)})),Ne.deserializeHooks.set("iff.engine.Moment",(e=>{let t=e;return new ct(t.passage,t.locals)})),Ne.serializeHooks.set(st.prototype,["iff.rand.RNG",e=>e.serialize()]),Ne.deserializeHooks.set("iff.rand.RNG",(e=>st.deserialize(e))),Ne.callbacks.push({tag:"history",onSave:()=>c(this.history),onLoad:e=>{this.history.set(e)}}),Ne.callbacks.push({tag:"visited",onSave:()=>c(this.visitedPassages),onLoad:e=>{this.visitedPassages.set(e??[])}}),Ne.callbacks.push({tag:"globals",onSave:()=>this.globals,onLoad:e=>{this.deleteGlobals();for(let[t,n]of Object.entries(e))this.globals[t]=n}})}get saveVersion(){return this.version}async reset(){if(this.initialHistory){if(this.loading.set(!0),"browser"==Me.visitedLinks){let e=new URL(window.location.toString());e.hash="",history.replaceState(null,"",e.toString())}if(this.history.set(structuredClone(this.initialHistory)),this.deleteGlobals(),this.visitedPassages.set([]),sessionStorage.removeItem(this.staticTitle+" save"),this.onReset)for(let e of this.onReset)try{e()}catch(e){console.log("Error in onReset: %o",e)}await new Promise((e=>{setTimeout(e,200)})),this.loading.set(!1)}}deleteGlobals(){let e=this.globals;for(let t of Object.keys(this.globals))delete e[t]}loadTheme=()=>function(e){let t=window.localStorage.getItem(e+nt);return null!==t?JSON.parse(t):null}(this.staticTitle);saveTheme=e=>{return t=this.staticTitle,n=e,void window.localStorage.setItem(t+nt,JSON.stringify(n));var t,n};applyTheme=rt;saveSession(){if(Me.sessionSave)try{let e=Ne.serializeData();2*e.length>=1e6?sessionStorage.removeItem(this.staticTitle+" save"):sessionStorage.setItem(this.staticTitle+" save",e)}catch(e){e instanceof DOMException&&e.code==DOMException.QUOTA_EXCEEDED_ERR?sessionStorage.removeItem(this.staticTitle+" save"):console.log("Error while saving to session storage: %o",e)}}async loadSave(e){if(this.loading.set(!0),e instanceof Promise)try{let t=await e;if(t.version!==this.version)return!1;Ne.loadData(t.data)}catch(e){console.log("Error while loading: %o",e)}finally{await new Promise((e=>{setTimeout(e,200)})),this.loading.set(!1)}else{if(e.version!==this.version)return!1;Ne.loadData(e.data),await new Promise((e=>{setTimeout(e,200)})),this.loading.set(!1)}return!0}init(e,t){if(this.version=t,this.initialHistory=structuredClone(e),this.history.subscribe((e=>{if(e.currentIndex>=e.moments.length)return;let t=e.moments[e.currentIndex].passage,n=c(this.visitedPassages);n.includes(t)||this.visitedPassages.set([...n,t])})),Me.sessionSave){try{let t=sessionStorage.getItem(this.staticTitle+" save");t?Ne.loadData(t):this.history.set(e)}catch(t){this.history.set(e)}this.history.subscribe((()=>{this.saveSession()}))}else{if(sessionStorage.removeItem(this.staticTitle+" save"),Me.autoload)return this.loading.set(!0),void(async()=>{let t=await this.saveDB.get(-1);t?Ne.loadData(t.data):this.history.set(e),this.loading.set(!1)})();this.history.set(e)}}addPassages(e){this._passages=[...this._passages,...e];for(let t of e)this._passagesByName.set(t.name,t)}get passages(){return this._passages.values}passageAt(e){return this._passages[e]}passage(e){return this._passagesByName.get(e)}goTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=c(this.history);for(n.moments=[new ct(e.name,t),...n.moments.slice(n.currentIndex)];n.moments.length>Me.historyLimit;)n.moments.pop();n.currentIndex=0,this.history.set(n)}}const dt=ft.engine;function ht(e){$(e,"svelte-1awtti3",".common.svelte-1awtti3{text-decoration:underline;cursor:pointer}.a.svelte-1awtti3{color:var(--link-color)}.v.svelte-1awtti3:visited{color:var(--link-visited-color)}.av.svelte-1awtti3{color:var(--link-visited-color)}")}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");const pt=e=>({}),yt=e=>({style:"color: inherit"});function vt(e){let t,n,r,o,i,a;const s=e[7].default,u=function(e,t,n,r){if(e){const o=f(e,t,n,r);return e[0](o)}}(s,e,e[6],yt);return{c(){t=T("a"),u&&u.c(),I(t,"href",n=e[1]()),I(t,"class",r=e[2]()+" common svelte-1awtti3")},m(n,r){P(n,t,r),u&&u.m(t,null),o=!0,i||(a=K(t,"click",e[0]),i=!0)},p(e,t){let[n]=t;u&&u.p&&(!o||64&n)&&function(e,t,n,r,o,i){if(o){const a=f(t,n,r,i);e.p(a,o)}}(u,s,e,e[6],o?function(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}(s,e[6],n,pt):function(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}(e[6]),yt)},i(e){o||(ve(u,e),o=!0)},o(e){me(u,e),o=!1},d(e){e&&E(t),u&&u.d(e),i=!1,a()}}}function mt(e,t,n){let{$$slots:r={},$$scope:o}=t,{passage:i}=t,{visited:a}=t,{noHref:s}=t,u=()=>{if(s||"save"==Me.visitedLinks)return;let e=new URL(window.location.toString());return e.hash=i,e.toString()};return e.$$set=e=>{"passage"in e&&n(3,i=e.passage),"visited"in e&&n(4,a=e.visited),"noHref"in e&&n(5,s=e.noHref),"$$scope"in e&&n(6,o=e.$$scope)},[e=>{e.preventDefault(),"browser"==Me.visitedLinks&&history.replaceState(null,"",u()),dt.goTo(dt.passage(i))},u,function(){let e=a;switch("save"==Me.visitedLinks&&void 0===e&&(e=c(dt.visitedPassages).includes(i)),e){case void 0:return"a v";case!0:return"av";case!1:return"a"}},i,a,s,o,r]}class gt extends Ae{constructor(e){super(),Ee(this,e,mt,vt,s,{passage:3,visited:4,noHref:5},ht)}get passage(){return this.$$.ctx[3]}set passage(e){this.$$set({passage:e}),ue()}get visited(){return this.$$.ctx[4]}set visited(e){this.$$set({visited:e}),ue()}get noHref(){return this.$$.ctx[5]}set noHref(e){this.$$set({noHref:e}),ue()}}Te(gt,{passage:{},visited:{},noHref:{}},["default"],[],!0);const bt=gt;class wt{static updater=new wt;_updateAvailable=Ke(!1);constructor(){this.updateAvailable=this._updateAvailable,new BroadcastChannel("iff-update").onmessage=e=>{let t=e.data;"check"===t.type&&t.available&&this._updateAvailable.set(!0)}}async register(){let e=navigator.serviceWorker.controller;if(e){let t={type:"check"};e.postMessage(t)}else{let e,t=new URL("./config.json",window.location.href),n=await caches.open("iff-cache");try{e=await fetch(t,{cache:"no-cache"}),200==e.status&&(await n.put(t,e),navigator.serviceWorker.register(new URL("./service.js",window.location.href)))}catch{}}}}const xt=wt.updater;function _t(e){const t=e-1;return t*t*t+1}function $t(e,{delay:n=0,duration:r=400,easing:o=t}={}){const i=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:o,css:e=>"opacity: "+e*i}}function kt(e,{delay:t=0,duration:n=400,easing:r=_t,axis:o="y"}={}){const i=getComputedStyle(e),a=+i.opacity,s="y"===o?"height":"width",u=parseFloat(i[s]),c="y"===o?["top","bottom"]:["left","right"],l=c.map((e=>`${e[0].toUpperCase()}${e.slice(1)}`)),f=parseFloat(i[`padding${l[0]}`]),d=parseFloat(i[`padding${l[1]}`]),h=parseFloat(i[`margin${l[0]}`]),p=parseFloat(i[`margin${l[1]}`]),y=parseFloat(i[`border${l[0]}Width`]),v=parseFloat(i[`border${l[1]}Width`]);return{delay:t,duration:n,easing:r,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*a};${s}: ${e*u}px;padding-${c[0]}: ${e*f}px;padding-${c[1]}: ${e*d}px;margin-${c[0]}: ${e*h}px;margin-${c[1]}: ${e*p}px;border-${c[0]}-width: ${e*y}px;border-${c[1]}-width: ${e*v}px;`}}function Ot(e){$(e,"svelte-q9qyth",".container.svelte-q9qyth{border-radius:10px;background-color:rgb(151, 148, 101);padding:0.5em}")}function St(t){let n;return{c(){n=T("div"),n.textContent="Update available: reload the page to apply",I(n,"class","container svelte-q9qyth")},m(e,t){P(e,n,t)},p:e,i:e,o:e,d(e){e&&E(n)}}}function Pt(e){return[]}class Et extends Ae{constructor(e){super(),Ee(this,e,Pt,St,s,{},Ot)}}Te(Et,{},[],[],!0);const Ct=Et;function Tt(e){$(e,"svelte-wyef2y","table.svelte-wyef2y.svelte-wyef2y{border-collapse:collapse;table-layout:fixed;border:2px solid var(--ui-primary-color)}thead.svelte-wyef2y.svelte-wyef2y{border-bottom:2px solid var(--ui-primary-color)}tbody.svelte-wyef2y td.svelte-wyef2y{text-align:center;padding:0.25em;border:1px solid var(--ui-primary-color)}tr.svelte-wyef2y .svelte-wyef2y:nth-child(1){line-break:anywhere}th.svelte-wyef2y.svelte-wyef2y{padding:0.5em;font-size:large}button.svelte-wyef2y.svelte-wyef2y{background-color:var(--background-color)}.container.svelte-wyef2y.svelte-wyef2y{display:flex;align-items:center;flex-direction:column}")}function At(e,t,n){const r=e.slice();return r[36]=t[n],r[38]=n,r}function jt(e){let t,n,r,o,i,a,s;return{c(){t=T("th"),t.textContent="Save/Overwrite",n=j(),r=T("th"),r.textContent="Load",o=j(),i=T("th"),i.textContent="Export",a=j(),s=T("th"),s.textContent="Delete",I(t,"class","svelte-wyef2y"),I(r,"class","svelte-wyef2y"),I(i,"class","svelte-wyef2y"),I(s,"class","svelte-wyef2y")},m(e,u){P(e,t,u),P(e,n,u),P(e,r,u),P(e,o,u),P(e,i,u),P(e,a,u),P(e,s,u)},d(e){e&&(E(t),E(n),E(r),E(o),E(i),E(a),E(s))}}}function Dt(e){let t;return{c(){t=T("th"),t.textContent="Save Overwrite Load Export Delete",q(t,"line-break","auto"),I(t,"class","svelte-wyef2y")},m(e,n){P(e,t,n)},d(e){e&&E(t)}}}function Kt(e){let t,n,r,o,i,a,s=e[3].date+"";function u(e,t){return e[1]<800?Bt:It}let c=u(e),l=c(e);return{c(){t=T("td"),t.textContent="Autosave",n=j(),r=T("td"),o=A(s),i=j(),l.c(),a=D(),I(t,"class","svelte-wyef2y"),I(r,"class","svelte-wyef2y")},m(e,s){P(e,t,s),P(e,n,s),P(e,r,s),_(r,o),P(e,i,s),l.m(e,s),P(e,a,s)},p(e,t){8&t[0]&&s!==(s=e[3].date+"")&&B(o,s),c===(c=u(e))&&l?l.p(e,t):(l.d(1),l=c(e),l&&(l.c(),l.m(a.parentNode,a)))},d(e){e&&(E(t),E(n),E(r),E(i),E(a)),l.d(e)}}}function It(t){let n,r,o,a,s,u,c,l,f,d;return{c(){n=T("td"),r=T("button"),r.textContent="Load",o=j(),a=T("td"),s=T("button"),s.textContent="Export",u=j(),c=T("td"),l=T("button"),l.textContent="Delete",I(r,"class","svelte-wyef2y"),I(n,"class","svelte-wyef2y"),I(s,"class","svelte-wyef2y"),I(a,"class","svelte-wyef2y"),I(l,"class","svelte-wyef2y"),I(c,"class","svelte-wyef2y")},m(e,i){P(e,n,i),_(n,r),P(e,o,i),P(e,a,i),_(a,s),P(e,u,i),P(e,c,i),_(c,l),f||(d=[K(r,"click",t[20]),K(s,"click",t[21]),K(l,"click",t[22])],f=!0)},p:e,d(e){e&&(E(n),E(o),E(a),E(u),E(c)),f=!1,i(d)}}}function Bt(t){let n,r,o,a,s,u,c,l;return{c(){n=T("td"),r=T("button"),r.textContent="Load",o=j(),a=T("button"),a.textContent="Export",s=j(),u=T("button"),u.textContent="Delete",I(r,"class","svelte-wyef2y"),I(a,"class","svelte-wyef2y"),I(u,"class","svelte-wyef2y"),I(n,"class","svelte-wyef2y")},m(e,i){P(e,n,i),_(n,r),_(n,o),_(n,a),_(n,s),_(n,u),c||(l=[K(r,"click",t[17]),K(a,"click",t[18]),K(u,"click",t[19])],c=!0)},p:e,d(e){e&&E(n),c=!1,i(l)}}}function Mt(e){let t,n,r,o,i,a,s,u=e[36].name+"",c=e[36].date.toLocaleString()+"";function l(e,t){return e[1]<800?Ft:Rt}let f=l(e),d=f(e);return{c(){t=T("td"),n=A(u),r=j(),o=T("td"),i=A(c),a=j(),d.c(),s=D(),I(t,"class","svelte-wyef2y"),I(o,"class","svelte-wyef2y")},m(e,u){P(e,t,u),_(t,n),P(e,r,u),P(e,o,u),_(o,i),P(e,a,u),d.m(e,u),P(e,s,u)},p(e,t){16&t[0]&&u!==(u=e[36].name+"")&&B(n,u),16&t[0]&&c!==(c=e[36].date.toLocaleString()+"")&&B(i,c),f===(f=l(e))&&d?d.p(e,t):(d.d(1),d=f(e),d&&(d.c(),d.m(s.parentNode,s)))},d(e){e&&(E(t),E(r),E(o),E(a),E(s)),d.d(e)}}}function qt(e){let t,n,r,o,i,a,s,u;function c(){return e[23](e[38])}return{c(){t=T("td"),n=j(),r=T("td"),o=j(),i=T("td"),a=T("button"),a.textContent="Save",I(t,"class","svelte-wyef2y"),I(r,"class","svelte-wyef2y"),I(a,"class","svelte-wyef2y"),I(i,"class","svelte-wyef2y")},m(e,l){P(e,t,l),P(e,n,l),P(e,r,l),P(e,o,l),P(e,i,l),_(i,a),s||(u=K(a,"click",c),s=!0)},p(t,n){e=t},d(e){e&&(E(t),E(n),E(r),E(o),E(i)),s=!1,u()}}}function Rt(e){let t,n,r,o,a,s,u,c,l,f,d,h,p;function y(){return e[28](e[38])}function v(){return e[29](e[38])}function m(){return e[30](e[38])}function g(){return e[31](e[38])}return{c(){t=T("td"),n=T("button"),n.textContent="Overwrite",r=j(),o=T("td"),a=T("button"),a.textContent="Load",s=j(),u=T("td"),c=T("button"),c.textContent="Export",l=j(),f=T("td"),d=T("button"),d.textContent="Delete",I(n,"class","svelte-wyef2y"),I(t,"class","svelte-wyef2y"),I(a,"class","svelte-wyef2y"),I(o,"class","svelte-wyef2y"),I(c,"class","svelte-wyef2y"),I(u,"class","svelte-wyef2y"),I(d,"class","svelte-wyef2y"),I(f,"class","svelte-wyef2y")},m(e,i){P(e,t,i),_(t,n),P(e,r,i),P(e,o,i),_(o,a),P(e,s,i),P(e,u,i),_(u,c),P(e,l,i),P(e,f,i),_(f,d),h||(p=[K(n,"click",y),K(a,"click",v),K(c,"click",m),K(d,"click",g)],h=!0)},p(t,n){e=t},d(e){e&&(E(t),E(r),E(o),E(s),E(u),E(l),E(f)),h=!1,i(p)}}}function Ft(e){let t,n,r,o,a,s,u,c,l,f;function d(){return e[24](e[38])}function h(){return e[25](e[38])}function p(){return e[26](e[38])}function y(){return e[27](e[38])}return{c(){t=T("td"),n=T("button"),n.textContent="Overwrite",r=j(),o=T("button"),o.textContent="Load",a=j(),s=T("button"),s.textContent="Export",u=j(),c=T("button"),c.textContent="Delete",I(n,"class","svelte-wyef2y"),I(o,"class","svelte-wyef2y"),I(s,"class","svelte-wyef2y"),I(c,"class","svelte-wyef2y"),I(t,"class","svelte-wyef2y")},m(e,i){P(e,t,i),_(t,n),_(t,r),_(t,o),_(t,a),_(t,s),_(t,u),_(t,c),l||(f=[K(n,"click",d),K(o,"click",h),K(s,"click",p),K(c,"click",y)],l=!0)},p(t,n){e=t},d(e){e&&E(t),l=!1,i(f)}}}function Nt(e){let t,n;function r(e,t){return null==e[36]?qt:Mt}let o=r(e),i=o(e);return{c(){t=T("tr"),i.c(),n=j(),I(t,"class","svelte-wyef2y")},m(e,r){P(e,t,r),i.m(t,null),_(t,n)},p(e,a){o===(o=r(e))&&i?i.p(e,a):(i.d(1),i=o(e),i&&(i.c(),i.m(t,n)))},d(e){e&&E(t),i.d()}}}function Lt(e){let t,n,r,o;return{c(){t=T("a"),n=A("Download Export"),I(t,"href",r=e[5].URL),I(t,"download",o=e[5].name+".save"),I(t,"target","_blank")},m(e,r){P(e,t,r),_(t,n)},p(e,n){32&n[0]&&r!==(r=e[5].URL)&&I(t,"href",r),32&n[0]&&o!==(o=e[5].name+".save")&&I(t,"download",o)},d(e){e&&E(t)}}}function zt(t){let n,r,o,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x,$,k,O,S,A,D,B,R;function F(e,t){return e[1]<800?Dt:jt}oe(t[16]);let N=F(t),L=N(t),z=t[3]&&Kt(t),H=_e(t[4]),U=[];for(let e=0;e<H.length;e+=1)U[e]=Nt(At(t,H,e));let Y=t[5]&&Lt(t);return{c(){n=T("div"),r=T("h1"),r.textContent="Save/Load",o=j(),a=T("table"),s=T("thead"),u=T("tr"),c=T("th"),c.textContent="Name",l=j(),f=T("th"),f.textContent="Date",d=j(),L.c(),h=j(),p=T("tbody"),z&&z.c(),y=j();for(let e=0;e<U.length;e+=1)U[e].c();v=j(),m=T("div"),Y&&Y.c(),g=j(),b=T("label"),b.textContent="Name:",w=j(),x=T("input"),$=j(),k=T("button"),k.textContent="New Save",O=j(),S=T("label"),S.textContent="Import:",A=j(),D=T("input"),q(c,"line-break","strict"),I(c,"class","svelte-wyef2y"),I(f,"class","svelte-wyef2y"),I(u,"class","svelte-wyef2y"),I(s,"class","svelte-wyef2y"),I(p,"class","svelte-wyef2y"),I(a,"class","svelte-wyef2y"),I(b,"for","name"),I(x,"id","name"),I(x,"type","text"),I(k,"class","svelte-wyef2y"),I(S,"for","import"),I(D,"id","import"),I(D,"type","file"),I(D,"accept",".save"),q(m,"padding","1em"),I(n,"class","container svelte-wyef2y")},m(e,i){P(e,n,i),_(n,r),_(n,o),_(n,a),_(a,s),_(s,u),_(u,c),_(u,l),_(u,f),_(u,d),L.m(u,null),_(a,h),_(a,p),z&&z.m(p,null),_(p,y);for(let e=0;e<U.length;e+=1)U[e]&&U[e].m(p,null);_(n,v),_(n,m),Y&&Y.m(m,null),_(m,g),_(m,b),_(m,w),_(m,x),M(x,t[0]),_(m,$),_(m,k),_(m,O),_(m,S),_(m,A),_(m,D),t[33](D),B||(R=[K(window,"resize",t[16]),K(x,"input",t[32]),K(k,"click",t[9])],B=!0)},p(e,t){if(N!==(N=F(e))&&(L.d(1),L=N(e),L&&(L.c(),L.m(u,null))),e[3]?z?z.p(e,t):(z=Kt(e),z.c(),z.m(p,y)):z&&(z.d(1),z=null),15378&t[0]){let n;for(H=_e(e[4]),n=0;n<H.length;n+=1){const r=At(e,H,n);U[n]?U[n].p(r,t):(U[n]=Nt(r),U[n].c(),U[n].m(p,null))}for(;n<U.length;n+=1)U[n].d(1);U.length=H.length}e[5]?Y?Y.p(e,t):(Y=Lt(e),Y.c(),Y.m(m,g)):Y&&(Y.d(1),Y=null),1&t[0]&&x.value!==e[0]&&M(x,e[0])},i:e,o:e,d(e){e&&E(n),L.d(),z&&z.d(),C(U,e),Y&&Y.d(),t[33](null),B=!1,i(R)}}}function Ht(e,t,n){let r,o,i,{saveDB:a}=t,{version:s}=t;const u=function(){const e=G();return(t,n,{cancelable:r=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=N(t,n,{cancelable:r});return o.slice().forEach((t=>{t.call(e,i)})),!i.defaultPrevented}return!0}}();let f="",d=Ue((()=>a.get(-1)));l(e,d,(e=>n(3,r=e)));let h=Ke(null);l(e,h,(e=>n(5,i=e)));let p,y=1/0;X((()=>{let e=c(h);null!=e&&(URL.revokeObjectURL(e.URL),h.set(null))}));let v=Ie(Ue((()=>a.getSaves())),(e=>{if(void 0===e)return[];let t=[];for(let n=0;n<=Math.max(10,...e.map((e=>e.slot)));n++){let r=e.find((e=>e.slot==n));r?t.push(r):t.push(null)}return t}));function m(){return{name:f,date:new Date,slot:-2,version:s,data:Ne.serializeData()}}function g(e){if(0!=f.length){let t=m();t.slot=e,a.saves.put(t,e)}}function b(e){a.saves.delete(e)}async function w(e){u("load",await a.get(e))}async function x(e){let t=await a.get(e),n=new Blob([JSON.stringify({data:t.data,version:t.version,title:a.name})]),r=c(h);null!=r&&URL.revokeObjectURL(r.URL),h.set({name:t.name,URL:URL.createObjectURL(n)})}return l(e,v,(e=>n(4,o=e))),Q((()=>{p.addEventListener("input",(async()=>{let e=p.files?.item(0);if(null!=e){let t;try{t=JSON.parse(await e.text())}catch{return}finally{n(2,p.value="",p)}if("string"!=typeof t.data||t.title!==a.name||t.version!==s)return;u("load",{name:"",date:new Date,data:t.data,slot:0,version:s})}}))})),e.$$set=e=>{"saveDB"in e&&n(14,a=e.saveDB),"version"in e&&n(15,s=e.version)},[f,y,p,r,o,i,d,h,v,function(){0!=f.length&&a.newSave(m())},g,b,w,x,a,s,function(){n(1,y=window.innerWidth)},()=>w(-1),()=>x(-1),()=>b(-1),()=>w(-1),()=>x(-1),()=>b(-1),e=>g(e),e=>g(e),e=>w(e),e=>x(e),e=>b(e),e=>g(e),e=>w(e),e=>x(e),e=>b(e),function(){f=this.value,n(0,f)},function(e){Z[e?"unshift":"push"]((()=>{p=e,n(2,p)}))}]}class Ut extends Ae{constructor(e){super(),Ee(this,e,Ht,zt,s,{saveDB:14,version:15},Tt,[-1,-1])}get saveDB(){return this.$$.ctx[14]}set saveDB(e){this.$$set({saveDB:e}),ue()}get version(){return this.$$.ctx[15]}set version(e){this.$$set({version:e}),ue()}}Te(Ut,{saveDB:{},version:{}},[],[],!0);const Yt=Ut;function Wt(t){let n,r;return n=new Yt({props:{version:dt.saveVersion,saveDB:dt.saveDB}}),n.$on("load",t[0]),{c(){Oe(n.$$.fragment)},m(e,t){Se(n,e,t),r=!0},p:e,i(e){r||(ve(n.$$.fragment,e),r=!0)},o(e){me(n.$$.fragment,e),r=!1},d(e){Pe(n,e)}}}function Vt(e){return[e=>dt.loadSave(e.detail)]}class Gt extends Ae{constructor(e){super(),Ee(this,e,Vt,Wt,s,{})}}Te(Gt,{},[],[],!0);const Qt=Gt;function Xt(e){$(e,"svelte-brt2vw",".button.svelte-brt2vw{display:block;color:inherit;border:2px solid var(--ui-primary-color);border-right-width:0px;border-top-width:1px}.disabled.svelte-brt2vw{border-color:var(--ui-secondary-color);color:var(--ui-secondary-color)}a.svelte-brt2vw{padding:0.5em;align-content:center;display:inline-block;user-select:none;font-size:1.5rem}")}function Jt(e,t,n){const r=e.slice();return r[13]=t[n],r}function Zt(e){let t,n,r;var o=e[13];return o&&(t=L(o,{})),{c(){t&&Oe(t.$$.fragment),n=D()},m(e,o){t&&Se(t,e,o),P(e,n,o),r=!0},p(e,r){if(1&r&&o!==(o=e[13])){if(t){pe();const e=t;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}o?(t=L(o,{}),Oe(t.$$.fragment),ve(t.$$.fragment,1),Se(t,n.parentNode,n)):t=null}},i(e){r||(t&&ve(t.$$.fragment,e),r=!0)},o(e){t&&me(t.$$.fragment,e),r=!1},d(e){e&&E(n),t&&Pe(t,e)}}}function en(e){let t,n,r,o,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x=_e(e[0]),$=[];for(let t=0;t<x.length;t+=1)$[t]=Zt(Jt(e,x,t));const k=e=>me($[e],1,1,(()=>{$[e]=null}));return{c(){t=T("div"),n=T("h2"),r=A(e[1]),o=j(),a=T("div"),s=T("a"),u=A(""),c=T("a"),l=A(""),f=j(),d=T("a"),h=A("Save/Load"),y=j();for(let e=0;e<$.length;e+=1)$[e].c();v=j(),m=T("a"),m.textContent="Reset",q(n,"border","1px solid var(--ui-primary-color)"),q(n,"border-right","0px"),q(n,"padding","0.5em"),q(n,"text-align","center"),q(n,"margin","0px"),q(s,"border","2px solid "+e[2]),q(s,"border-right-width","1px}"),q(s,"border-top-width","1px"),q(s,"color",e[2]),I(s,"class","svelte-brt2vw"),q(c,"border","2px solid "+e[3]),q(c,"border-left-width","1px"),q(c,"border-top-width","1px"),q(c,"color",e[3]),I(c,"class","svelte-brt2vw"),I(d,"class",p="button "+(e[4]?"":"disabled")+" svelte-brt2vw"),I(m,"class","button svelte-brt2vw"),q(t,"border-right","2px solid var(--ui-primary-color)"),q(t,"height","100%")},m(i,p){P(i,t,p),_(t,n),_(n,r),_(t,o),_(t,a),_(a,s),_(s,u),_(a,c),_(c,l),_(t,f),_(t,d),_(d,h),_(t,y);for(let e=0;e<$.length;e+=1)$[e]&&$[e].m(t,null);_(t,v),_(t,m),g=!0,b||(w=[K(s,"click",e[9]),K(c,"click",e[10]),K(d,"click",e[12]),K(m,"click",e[11])],b=!0)},p(e,n){let[o]=n;if((!g||2&o)&&B(r,e[1]),(!g||4&o)&&q(s,"border","2px solid "+e[2]),(!g||4&o)&&q(s,"color",e[2]),(!g||8&o)&&q(c,"border","2px solid "+e[3]),(!g||8&o)&&q(c,"color",e[3]),(!g||16&o&&p!==(p="button "+(e[4]?"":"disabled")+" svelte-brt2vw"))&&I(d,"class",p),1&o){let n;for(x=_e(e[0]),n=0;n<x.length;n+=1){const r=Jt(e,x,n);$[n]?($[n].p(r,o),ve($[n],1)):($[n]=Zt(r),$[n].c(),ve($[n],1),$[n].m(t,v))}for(pe(),n=x.length;n<$.length;n+=1)k(n);ye()}},i(e){if(!g){for(let e=0;e<x.length;e+=1)ve($[e]);g=!0}},o(e){$=$.filter(Boolean);for(let e=0;e<$.length;e+=1)me($[e]);g=!1},d(e){e&&E(t),C($,e),b=!1,i(w)}}}function tn(e,t,n){let r,o,i,a,{components:s}=t,u=Ie([dt.history,Me.userNavigable],(e=>{let[t,n]=e;return t.currentIndex>=t.moments.length-1||!n?"var(--ui-secondary-color)":"var(--ui-primary-color)"}));l(e,u,(e=>n(2,o=e)));let f=Ie([dt.history,Me.userNavigable],(e=>{let[t,n]=e;return 0!=t.currentIndex&&n?"var(--ui-primary-color)":"var(--ui-secondary-color)"}));l(e,f,(e=>n(3,i=e)));let d=Me.userSavable;l(e,d,(e=>n(4,a=e)));let h=dt.title;return l(e,h,(e=>n(1,r=e))),e.$$set=e=>{"components"in e&&n(0,s=e.components)},[s,r,o,i,a,u,f,d,h,()=>{let e=c(dt.history);e.currentIndex<e.moments.length-1&&c(Me.userNavigable)&&(e.currentIndex+=1,dt.history.set(e))},()=>{let e=c(dt.history);e.currentIndex>0&&c(Me.userNavigable)&&(e.currentIndex-=1,dt.history.set(e))},function(){dt.reset()},function(){c(d)&&(c(gn).find((e=>e.component===Qt))||gn.set([...c(gn),{component:Qt,dismissible:!0}]))}]}class nn extends Ae{constructor(e){super(),Ee(this,e,tn,en,s,{components:0},Xt)}get components(){return this.$$.ctx[0]}set components(e){this.$$set({components:e}),ue()}}Te(nn,{components:{}},[],[],!0);const rn=nn,{setTimeout:on,window:an}=g;function sn(e){$(e,"svelte-1lhn1ng",".spinner.svelte-1lhn1ng{position:absolute;clip-path:circle(1vh);width:10vh;height:10vh;background-color:var(--text-color)}.overlayContainer.svelte-1lhn1ng{background-color:var(--ui-secondary-color);border-radius:20px;padding:1em;overflow-y:auto;max-width:90vw;max-height:90vh}.overlayBackground.svelte-1lhn1ng{display:flex;align-items:center;justify-content:center;width:100%;height:100%;position:absolute;top:0px;left:0px;background-color:rgba(0, 0, 0, 0.4)}.content.svelte-1lhn1ng{display:flex;flex-direction:row;height:100%}.passage.svelte-1lhn1ng{padding:1em;box-sizing:border-box;flex:10}.passage-visible.svelte-1lhn1ng{opacity:1}.passage-invisible.svelte-1lhn1ng{opacity:0}.main.svelte-1lhn1ng{flex:5;display:flex;flex-direction:column;height:fit-content}.update.svelte-1lhn1ng{z-index:100;position:absolute;right:1em;bottom:1em}")}function un(e,t,n){const r=e.slice();return r[32]=t[n],r}function cn(e){let t,n,r,o,i,a,s,u,c,l,f,d,h;r=new rn({props:{components:e[0]}});let p=e[1]&&ln(e);const y=[dn,fn],v=[];function m(e,t){return 0==e[3]?0:1}u=m(e),c=v[u]=y[u](e);let g=e[2]&&hn(e);return{c(){t=T("div"),n=T("div"),Oe(r.$$.fragment),i=j(),a=T("div"),p&&p.c(),s=j(),c.c(),l=j(),g&&g.c(),q(n,"flex","1"),oe((()=>e[30].call(n))),I(a,"class","main svelte-1lhn1ng"),oe((()=>e[31].call(a))),I(t,"class","content svelte-1lhn1ng")},m(c,d){P(c,t,d),_(t,n),Se(r,n,null),e[29](n),o=F(n,e[30].bind(n)),_(t,i),_(t,a),p&&p.m(a,null),_(a,s),v[u].m(a,null),_(a,l),g&&g.m(a,null),f=F(a,e[31].bind(a)),h=!0},p(e,t){const n={};1&t[0]&&(n.components=e[0]),r.$set(n),e[1]?p?(p.p(e,t),2&t[0]&&ve(p,1)):(p=ln(e),p.c(),ve(p,1),p.m(a,s)):p&&(pe(),me(p,1,1,(()=>{p=null})),ye());let o=u;u=m(e),u===o?v[u].p(e,t):(pe(),me(v[o],1,1,(()=>{v[o]=null})),ye(),c=v[u],c?c.p(e,t):(c=v[u]=y[u](e),c.c()),ve(c,1),c.m(a,l)),e[2]?g?(g.p(e,t),4&t[0]&&ve(g,1)):(g=hn(e),g.c(),ve(g,1),g.m(a,null)):g&&(pe(),me(g,1,1,(()=>{g=null})),ye())},i(e){h||(ve(r.$$.fragment,e),ve(p),ve(c),ve(g),d||oe((()=>{d=be(t,$t,{duration:200}),d.start()})),h=!0)},o(e){me(r.$$.fragment,e),me(p),me(c),me(g),h=!1},d(n){n&&E(t),Pe(r),e[29](null),o(),p&&p.d(),v[u].d(),g&&g.d(),f()}}}function ln(e){let t,n,r;var o=e[1];return o&&(t=L(o,{})),{c(){t&&Oe(t.$$.fragment),n=D()},m(e,o){t&&Se(t,e,o),P(e,n,o),r=!0},p(e,r){if(2&r[0]&&o!==(o=e[1])){if(t){pe();const e=t;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}o?(t=L(o,{}),Oe(t.$$.fragment),ve(t.$$.fragment,1),Se(t,n.parentNode,n)):t=null}},i(e){r||(t&&ve(t.$$.fragment,e),r=!0)},o(e){t&&me(t.$$.fragment,e),r=!1},d(e){e&&E(n),t&&Pe(t,e)}}}function fn(e){let t,n,r,o;var i=e[15].component;return i&&(n=L(i,{})),{c(){t=T("div"),n&&Oe(n.$$.fragment),q(t,"transition","opacity "+e[3]+"ms"),I(t,"class",r="passage "+e[14]+" iff-passage svelte-1lhn1ng")},m(e,r){P(e,t,r),n&&Se(n,t,null),o=!0},p(e,a){if(32768&a[0]&&i!==(i=e[15].component)){if(n){pe();const e=n;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}i?(n=L(i,{}),Oe(n.$$.fragment),ve(n.$$.fragment,1),Se(n,t,null)):n=null}(!o||8&a[0])&&q(t,"transition","opacity "+e[3]+"ms"),(!o||16384&a[0]&&r!==(r="passage "+e[14]+" iff-passage svelte-1lhn1ng"))&&I(t,"class",r)},i(e){o||(n&&ve(n.$$.fragment,e),o=!0)},o(e){n&&me(n.$$.fragment,e),o=!1},d(e){e&&E(t),n&&Pe(n)}}}function dn(e){let t,n,r;var o=e[13].component;return o&&(n=L(o,{})),{c(){t=T("div"),n&&Oe(n.$$.fragment),I(t,"class","passage svelte-1lhn1ng")},m(e,o){P(e,t,o),n&&Se(n,t,null),r=!0},p(e,r){if(8192&r[0]&&o!==(o=e[13].component)){if(n){pe();const e=n;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}o?(n=L(o,{}),Oe(n.$$.fragment),ve(n.$$.fragment,1),Se(n,t,null)):n=null}},i(e){r||(n&&ve(n.$$.fragment,e),r=!0)},o(e){n&&me(n.$$.fragment,e),r=!1},d(e){e&&E(t),n&&Pe(n)}}}function hn(e){let t,n,r;var o=e[2];return o&&(t=L(o,{})),{c(){t&&Oe(t.$$.fragment),n=D()},m(e,o){t&&Se(t,e,o),P(e,n,o),r=!0},p(e,r){if(4&r[0]&&o!==(o=e[2])){if(t){pe();const e=t;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}o?(t=L(o,{}),Oe(t.$$.fragment),ve(t.$$.fragment,1),Se(t,n.parentNode,n)):t=null}},i(e){r||(t&&ve(t.$$.fragment,e),r=!0)},o(e){t&&me(t.$$.fragment,e),r=!1},d(e){e&&E(n),t&&Pe(t,e)}}}function pn(e){let t,n,r,o;return n=new Ct({}),{c(){t=T("div"),Oe(n.$$.fragment),I(t,"class","update svelte-1lhn1ng")},m(e,r){P(e,t,r),Se(n,t,null),o=!0},i(e){o||(ve(n.$$.fragment,e),e&&(r||oe((()=>{r=be(t,$t,{duration:500}),r.start()}))),o=!0)},o(e){me(n.$$.fragment,e),o=!1},d(e){e&&E(t),Pe(n)}}}function yn(e){let t,n,r=[],o=new Map,a=_e(e[17]);const s=e=>e[32];for(let t=0;t<a.length;t+=1){let n=un(e,a,t),i=s(n);o.set(i,r[t]=vn(i,n))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=D()},m(e,o){for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,o);P(e,t,o),n=!0},p(e,n){16910336&n[0]&&(a=_e(e[17]),pe(),r=function(e,t,n,r,o,a,s,u,c,l,f,d){let h=e.length,p=a.length,y=h;const v={};for(;y--;)v[e[y].key]=y;const m=[],g=new Map,b=new Map,w=[];for(y=p;y--;){const e=d(o,a,y),r=n(e);let i=s.get(r);i?w.push((()=>i.p(e,t))):(i=l(r,e),i.c()),g.set(r,m[y]=i),r in v&&b.set(r,Math.abs(y-v[r]))}const x=new Set,_=new Set;function $(e){ve(e,1),e.m(u,f),s.set(e.key,e),f=e.first,p--}for(;h&&p;){const t=m[p-1],n=e[h-1],r=t.key,o=n.key;t===n?(f=t.first,h--,p--):g.has(o)?!s.has(r)||x.has(r)?$(t):_.has(o)?h--:b.get(r)>b.get(o)?(_.add(r),$(t)):(x.add(o),h--):(c(n,s),h--)}for(;h--;){const t=e[h];g.has(t.key)||c(t,s)}for(;p;)$(m[p-1]);return i(w),m}(r,n,s,0,e,a,o,t.parentNode,$e,vn,t,un),ye())},i(e){if(!n){for(let e=0;e<a.length;e+=1)ve(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)me(r[e]);n=!1},d(e){e&&E(t);for(let t=0;t<r.length;t+=1)r[t].d(e)}}}function vn(e,t){let n,r,o,i,a,s,u,c;var l=t[32].component;return l&&(o=L(l,{})),{key:e,first:null,c(){n=T("div"),r=T("div"),o&&Oe(o.$$.fragment),i=j(),I(r,"class","overlayContainer svelte-1lhn1ng"),I(n,"class","overlayBackground svelte-1lhn1ng"),q(n,"top",t[11]+"px"),this.first=n},m(e,a){var l;P(e,n,a),_(n,r),o&&Se(o,r,null),_(n,i),s=!0,u||(c=K(n,"click",(l=t[24],function(e){e.target===this&&l.call(this,e)})),u=!0)},p(e,i){if(t=e,131072&i[0]&&l!==(l=t[32].component)){if(o){pe();const e=o;me(e.$$.fragment,1,0,(()=>{Pe(e,1)})),ye()}l?(o=L(l,{}),Oe(o.$$.fragment),ve(o.$$.fragment,1),Se(o,r,null)):o=null}(!s||2048&i[0])&&q(n,"top",t[11]+"px")},i(e){s||(o&&ve(o.$$.fragment,e),oe((()=>{s&&(a||(a=xe(n,$t,{duration:100},!0)),a.run(1))})),s=!0)},o(e){o&&me(o.$$.fragment,e),a||(a=xe(n,$t,{duration:100},!1)),a.run(0),s=!1},d(e){e&&E(n),o&&Pe(o),e&&a&&a.end(),u=!1,c()}}}function mn(e){let t,n,r,o,a,s,u,c,l,f,d,h,p,y,v,m=!1,g=()=>{m=!1};oe(e[25]);let b=!e[12]&&cn(e),w=e[16]&&pn(),x=0!=e[17].length&&yn(e);return{c(){n=T("div"),r=T("div"),o=j(),a=T("div"),s=j(),u=T("div"),l=j(),b&&b.c(),f=j(),w&&w.c(),d=j(),x&&x.c(),h=D(),I(r,"class","spinner svelte-1lhn1ng"),I(r,"aria-label","Loading spinner"),I(a,"class","spinner svelte-1lhn1ng"),I(u,"class","spinner svelte-1lhn1ng"),I(n,"class","content svelte-1lhn1ng"),I(n,"style",c="width: 100%; align-items: center; justify-content: center; "+(e[10]?"display: flex;":"display: none;"))},m(i,c){P(i,n,c),_(n,r),e[26](r),_(n,o),_(n,a),e[27](a),_(n,s),_(n,u),e[28](u),P(i,l,c),b&&b.m(i,c),P(i,f,c),w&&w.m(i,c),P(i,d,c),x&&x.m(i,c),P(i,h,c),p=!0,y||(v=[K(an,"keydown",e[23]),K(an,"scroll",(()=>{m=!0,clearTimeout(t),t=on(g,100),e[25]()}))],y=!0)},p(e,r){2048&r[0]&&!m&&(m=!0,clearTimeout(t),scrollTo(an.pageXOffset,e[11]),t=on(g,100)),(!p||1024&r[0]&&c!==(c="width: 100%; align-items: center; justify-content: center; "+(e[10]?"display: flex;":"display: none;")))&&I(n,"style",c),e[12]?b&&(pe(),me(b,1,1,(()=>{b=null})),ye()):b?(b.p(e,r),4096&r[0]&&ve(b,1)):(b=cn(e),b.c(),ve(b,1),b.m(f.parentNode,f)),e[16]?w?65536&r[0]&&ve(w,1):(w=pn(),w.c(),ve(w,1),w.m(d.parentNode,d)):w&&(pe(),me(w,1,1,(()=>{w=null})),ye()),0!=e[17].length?x?(x.p(e,r),131072&r[0]&&ve(x,1)):(x=yn(e),x.c(),ve(x,1),x.m(h.parentNode,h)):x&&(pe(),me(x,1,1,(()=>{x=null})),ye())},i(e){p||(ve(b),ve(w),ve(x),p=!0)},o(e){me(b),me(w),me(x),p=!1},d(t){t&&(E(n),E(l),E(f),E(d),E(h)),e[26](null),e[27](null),e[28](null),b&&b.d(t),w&&w.d(t),x&&x.d(t),y=!1,i(v)}}}const gn=Ke([]);function bn(t,n,r){let o,i,a,s,u,f,d=e;l(t,gn,(e=>r(17,f=e))),t.$$.on_destroy.push((()=>d()));let{sidebarComponents:h=[]}=n,{header:p}=n,{footer:y}=n,{transitionDuration:v=200}=n;const m=dt.currentPassage;l(t,m,(e=>r(13,i=e)));const g=xt.updateAvailable;l(t,g,(e=>r(16,u=e)));const b=dt.loading;l(t,b,(e=>r(12,o=e)));const w=Ke("passage-visible");l(t,w,(e=>r(14,a=e)));const x=Ke(c(m));let _,$,k;l(t,x,(e=>r(15,s=e)));let O,S,P,E,C=!1;function T(){gn.set([...c(gn).slice(0,-1)])}return 0!=v&&Q((()=>m.subscribe((()=>{"passage-visible"===c(w)&&(w.set("passage-invisible"),setTimeout((()=>{x.set(c(m)),w.set("passage-visible")}),v))})))),Q((()=>{let e,t=null,n=null,o=0;function i(e,t,n){let[r,o]=function(e,t){let[n,r]=e;return[n*Math.cos(t)-r*Math.sin(t),n*Math.sin(t)+r*Math.cos(t)]}(e,t);n.style.cssText=`top: calc(50vh + ${o}px); left: calc(50vw + ${r}px);`}function a(e){return e*Math.PI/180}return i([0,-50],0,_),i([0,-50],a(120),$),i([0,-50],a(240),k),e=s=>{if(null!=n){let e;o+=(s-n)/10,o%=70,e=o<50?o/50*a(120):a(120),i([0,-50],e,_),i([0,-50],e+a(120),$),i([0,-50],e+a(240),k)}C||r(10,C=!0),n=s,t=requestAnimationFrame(e)},b.subscribe((s=>{s?t=requestAnimationFrame(e):(null!=t&&cancelAnimationFrame(t),t=null,n=null,o=0,r(10,C=!1),setTimeout((()=>{c(b)||(i([0,-50],0,_),i([0,-50],a(120),$),i([0,-50],a(240),k))}),0))}))})),t.$$set=e=>{"sidebarComponents"in e&&r(0,h=e.sidebarComponents),"header"in e&&r(1,p=e.header),"footer"in e&&r(2,y=e.footer),"transitionDuration"in e&&r(3,v=e.transitionDuration)},t.$$.update=()=>{112&t.$$.dirty[0]&&null!=P&&O>S&&r(6,P.style.height=O+"px",P),112&t.$$.dirty[0]&&null!=P&&S>O&&S>window.innerHeight&&r(6,P.style.height="100%",P)},[h,p,y,v,O,S,P,_,$,k,C,E,o,i,a,s,u,f,m,g,b,w,x,function(e){e.ctrlKey&&"s"==e.key.toLowerCase()&&(e.preventDefault(),c(Me.userSavable)&&(c(gn).find((e=>e.component===Qt))?gn.set(c(gn).filter((e=>e.component!==Qt))):gn.set([...c(gn),{component:Qt,dismissible:!0}]))),"Escape"===e.key&&0!=c(gn).length&&T()},T,function(){r(11,E=an.pageYOffset)},function(e){Z[e?"unshift":"push"]((()=>{_=e,r(7,_)}))},function(e){Z[e?"unshift":"push"]((()=>{$=e,r(8,$)}))},function(e){Z[e?"unshift":"push"]((()=>{k=e,r(9,k)}))},function(e){Z[e?"unshift":"push"]((()=>{P=e,r(6,P),r(4,O),r(5,S)}))},function(){S=this.offsetHeight,r(5,S)},function(){O=this.offsetHeight,r(4,O)}]}class wn extends Ae{constructor(e){super(),Ee(this,e,bn,mn,s,{sidebarComponents:0,header:1,footer:2,transitionDuration:3},sn,[-1,-1])}get sidebarComponents(){return this.$$.ctx[0]}set sidebarComponents(e){this.$$set({sidebarComponents:e}),ue()}get header(){return this.$$.ctx[1]}set header(e){this.$$set({header:e}),ue()}get footer(){return this.$$.ctx[2]}set footer(e){this.$$set({footer:e}),ue()}get transitionDuration(){return this.$$.ctx[3]}set transitionDuration(e){this.$$set({transitionDuration:e}),ue()}}Te(wn,{sidebarComponents:{},header:{},footer:{},transitionDuration:{}},[],[],!0);const xn=wn;let _n;function $n(){let e=On(),t=Ie([e.breachesFront,e.breachesMid,e.breachesAft],(e=>{let[t,n,r]=e;return Math.max(100-10*(t+n+r),0)}));t.subscribe((e=>{e<=1&&dt.goTo(dt.passage("fail"))})),_n=t,e.progress.subscribe((t=>{if(t>=100){e.progress.set(0);let t=c(e.stage);e.breachesAft.set(0),e.breachesMid.set(0),e.breachesFront.set(0),e.navOffline.set(!1),e.enginesOffline.set(!1),c(e.scrap)<2&&e.scrap.set(2),e.meteorFrequency.set(.2+.05*t),e.stage.set(t+1),dt.goTo(dt.passage("ftl"+t))}}))}const kn=$n;function On(){let e=dt.globals;return e.stage??=Ke(1),e.progress??=Ke(0),e.breachesFront??=Ke(0),e.breachesMid??=Ke(0),e.breachesAft??=Ke(0),e.fuel??=Ke(100),e.scrap??=Ke(2),e.navOffline??=Ke(!1),e.enginesOffline??=Ke(!1),e.meteorFrequency??=Ke(.2),e.rng??=new st,e}function Sn(e){let t=Pn();c(_n)>.03&&dt.goTo(dt.passage(e),{event:t})}function Pn(){let e=On(),t=e.rng,n=Math.max(0,Math.min(.9,c(e.meteorFrequency)-("front"===c(dt.currentPassage).name?.2:0)+(c(e.enginesOffline)?.2:0))),r=["nav","meteorFront","meteorMid","meteorAft","engines",null][t.choose([.05,n/3,n/3,n/3,.05,.9-n])];switch(r){case"meteorFront":e.breachesFront.set(c(e.breachesFront)+1);break;case"meteorMid":e.breachesMid.set(c(e.breachesMid)+1);break;case"meteorAft":e.breachesAft.set(c(e.breachesAft)+1);break;case"nav":c(e.navOffline)?r=null:e.navOffline.set(!0);break;case"engines":c(e.enginesOffline)?r=null:e.enginesOffline.set(!0)}n=c(e.meteorFrequency);let o=Math.max(Math.min(.2+(c(e.stage)-1)/20-n,.25),-.25);switch(t.choose([.25-o,.25+o,.5])){case 0:n-=.05;break;case 1:n+=.05}return e.meteorFrequency.set(n),c(e.navOffline)||e.progress.set(c(e.progress)+5),r}function En(e){let t,n,r;const o=[An,Tn,Cn],i=[];function a(e,t){return"engines"==e[1]?0:"nav"==e[1]?1:2}return t=a(e),n=i[t]=o[t](e),{c(){n.c(),r=D()},m(e,n){i[t].m(e,n),P(e,r,n)},p(e,s){let u=t;t=a(e),t===u?i[t].p(e,s):(pe(),me(i[u],1,1,(()=>{i[u]=null})),ye(),n=i[t],n?n.p(e,s):(n=i[t]=o[t](e),n.c()),ve(n,1),n.m(r.parentNode,r))},d(e){e&&E(r),i[t].d(e)}}}function Cn(t){let n,r,o,i;return{c(){n=T("div"),n.textContent=`You hear a load bang and sizzling as air escapes through a hull breach in the ${t[2]()}.`},m(e,t){P(e,n,t),i=!0},p:e,i(e){i||(e&&oe((()=>{i&&(o&&o.end(1),r=be(n,$t,{duration:500}),r.start())})),i=!0)},o(e){r&&r.invalidate(),e&&(o=we(n,$t,{duration:500})),i=!1},d(e){e&&E(n),e&&o&&o.end()}}}function Tn(t){let n,r,o,i;return{c(){n=T("div"),n.innerHTML="You hear a familiar sequence of beeps from the front of the ship. The navigation computer has broken again.<br/>\n        A broken navigation computer can&#39;t calculate an FTL flight, so you should fix it ASAP."},m(e,t){P(e,n,t),i=!0},p:e,i(e){i||(e&&oe((()=>{i&&(o&&o.end(1),r=be(n,$t,{duration:500}),r.start())})),i=!0)},o(e){r&&r.invalidate(),e&&(o=we(n,$t,{duration:500})),i=!1},d(e){e&&E(n),e&&o&&o.end()}}}function An(t){let n,r,o,i;return{c(){n=T("div"),n.innerHTML="Suddenly you are slammed against a wall before the ship&#39;s computer has time to compensate as the engines fizzle out.<br/>\n        Broken engines mean you can&#39;t evade any asteroids or start an FTL flight, so you should fix them ASAP."},m(e,t){P(e,n,t),i=!0},p:e,i(e){i||(e&&oe((()=>{i&&(o&&o.end(1),r=be(n,$t,{duration:500}),r.start())})),i=!0)},o(e){r&&r.invalidate(),e&&(o=we(n,$t,{duration:500})),i=!1},d(e){e&&E(n),e&&o&&o.end()}}}function jn(t){let n,r=null!==t[1]&&En(t);return{c(){r&&r.c(),n=D()},m(e,t){r&&r.m(e,t),P(e,n,t)},p(e,t){let[o]=t;null!==e[1]?r?r.p(e,o):(r=En(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&E(n),r&&r.d(e)}}}function Dn(t,n,r){let o,i=e,a=()=>(i(),i=u(s,(e=>r(1,o=e))),s);t.$$.on_destroy.push((()=>i()));let{event:s}=n;return a(),t.$$set=e=>{"event"in e&&a(r(0,s=e.event))},[s,o,function(){switch(c(s)){case"meteorAft":return"aft";case"meteorFront":return"front";case"meteorMid":return"midsection"}return""}]}dt.onReset.push($n);class Kn extends Ae{constructor(e){super(),Ee(this,e,Dn,jn,s,{event:0})}get event(){return this.$$.ctx[0]}set event(e){this.$$set({event:e}),ue()}}Te(Kn,{event:{}},[],[],!0);const In=Kn;function Bn(e){let t,n,r,o,i;return{c(){t=T("a"),n=A("Repair the engines. (Requires 2 sorted scrap)"),I(t,"style",r=e[1]<2?"color: grey;":"")},m(r,a){P(r,t,a),_(t,n),o||(i=K(t,"click",e[7]),o=!0)},p(e,n){2&n&&r!==(r=e[1]<2?"color: grey;":"")&&I(t,"style",r)},d(e){e&&E(t),o=!1,i()}}}function Mn(e){let t,n,r,o,i;return{c(){t=T("a"),n=A("Repair a hull breach. (Requires 1 sorted scrap)"),I(t,"style",r=e[1]<1?"color: grey;":"")},m(r,a){P(r,t,a),_(t,n),o||(i=K(t,"click",e[8]),o=!0)},p(e,n){2&n&&r!==(r=e[1]<1?"color: grey;":"")&&I(t,"style",r)},d(e){e&&E(t),o=!1,i()}}}function qn(e){let t,n,r,o,i,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x,$,k,O,S,C=e[0]&&Bn(e),D=e[2]>0&&Mn(e);return d=new In({props:{event:e[3]}}),{c(){t=A("The aft, where your engines and your generator are located."),n=T("br"),r=A("\nNormally you also use this room as an additional storage for scrap, but you only have the scrap in the midsection left now.\n"),o=T("br"),i=j(),C&&C.c(),a=j(),s=T("br"),u=j(),D&&D.c(),c=j(),l=T("br"),f=j(),Oe(d.$$.fragment),h=j(),p=T("br"),y=T("br"),v=T("br"),m=j(),g=T("div"),b=T("a"),b.textContent="Got to the midsection",w=T("br")},m(x,$){P(x,t,$),P(x,n,$),P(x,r,$),P(x,o,$),P(x,i,$),C&&C.m(x,$),P(x,a,$),P(x,s,$),P(x,u,$),D&&D.m(x,$),P(x,c,$),P(x,l,$),P(x,f,$),Se(d,x,$),P(x,h,$),P(x,p,$),P(x,y,$),P(x,v,$),P(x,m,$),P(x,g,$),_(g,b),_(g,w),k=!0,O||(S=K(b,"click",e[9]),O=!0)},p(e,t){let[n]=t;e[0]?C?C.p(e,n):(C=Bn(e),C.c(),C.m(a.parentNode,a)):C&&(C.d(1),C=null),e[2]>0?D?D.p(e,n):(D=Mn(e),D.c(),D.m(c.parentNode,c)):D&&(D.d(1),D=null)},i(e){k||(ve(d.$$.fragment,e),e&&oe((()=>{k&&($&&$.end(1),x=be(g,$t,{duration:200}),x.start())})),k=!0)},o(e){me(d.$$.fragment,e),x&&x.invalidate(),e&&($=we(g,$t,{duration:200})),k=!1},d(e){e&&(E(t),E(n),E(r),E(o),E(i),E(a),E(s),E(u),E(c),E(l),E(f),E(h),E(p),E(y),E(v),E(m),E(g)),C&&C.d(e),D&&D.d(e),Pe(d,e),e&&$&&$.end(),O=!1,S()}}}function Rn(e,t,n){let r,o,i;var a;let s=Ke(null!==(a=dt.locals.event)&&void 0!==a?a:null),u=On(),f=u.breachesAft;l(e,f,(e=>n(2,i=e)));let d=u.scrap;l(e,d,(e=>n(1,o=e)));let h=u.enginesOffline;return l(e,h,(e=>n(0,r=e))),[r,o,i,s,f,d,h,function(){c(d)>=2&&(d.set(c(d)-2),h.set(!1),s.set(Pn()))},function(){c(d)>=1&&(d.set(c(d)-1),f.set(c(f)-1),s.set(Pn()))},()=>Sn("midsection")]}class Fn extends Ae{constructor(e){super(),Ee(this,e,Rn,qn,s,{})}}Te(Fn,{},[],[],!0);const Nn=Fn;function Ln(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML="<p>You arrive at the battlefield. You carefully navigate to one of the nearest wreckages and exit your airlock.<br>As expected, the ship&#39;s airlocks don&#39;t work anymore without power.<br>The other side of the ship is fully melted, so there&#39;s no way in from there, too.<br>You use your heavy laser cutter to gradually cut through the hull.</p><br><p>The inside is in rather pristine condition: Only the other side that likely contained the ship&#39;s command room got melted.<br>The survivors of this side probably left with escape pods, that may or may not have been shot down.</p><br><p>You make your way to the engine room, because other heavy machinery is often located there as well as the generator, for short high-power cables.<br>You don&#39;t believe your eyes: There&#39;s an apparently completely intact FTL drive, one for this size of a ship is sure to make you a hefty sum.</p><br><p>You begin by cutting the ground around where the drive is welded in, and proceed to cut through the walls until you&#39;re outside again.<br>Then you tie the drive to your ship so it&#39;s still in range of your own FTL drive and plate it with the hull you&#39;ve cut out to save it from meteorites.</p><br><p>You continue to loot the other ships, but none are in as got as a condition as this. Soon your ship is filled to the brim with scrap and components again, and you instruct your navigation computer to route you to the nearest market planet. Maybe you&#39;ll be able to upgrade your reactor and afford a small shield generator now, so that you don&#39;t have to worry about meteorites anymore.</p><br><p>The End.</p><br>"},p:e,i:e,o:e,d(e){e&&E(n)}}}function zn(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML="<p>With shock you see how a meteorite shattered a piece of hull completely and still had enough force to penetrate your ship&#39;s reactor.<br>The last thing you see is the white flash of your reactor&#39;s explosion...</p><br>"},p:e,i:e,o:e,d(e){e&&E(n)}}}function Hn(e){let t,n,r,o,i,a,s;return{c(){t=T("a"),n=A("Repair the navigation computer. (Requires 2 sorted scrap)"),I(t,"style",r=e[2]<2?"color: grey;":"")},m(r,o){P(r,t,o),_(t,n),i=!0,a||(s=K(t,"click",e[10]),a=!0)},p(e,n){(!i||4&n&&r!==(r=e[2]<2?"color: grey;":""))&&I(t,"style",r)},i(e){i||(e&&oe((()=>{i&&(o||(o=xe(t,$t,{duration:200},!0)),o.run(1))})),i=!0)},o(e){e&&(o||(o=xe(t,$t,{duration:200},!1)),o.run(0)),i=!1},d(e){e&&E(t),e&&o&&o.end(),a=!1,s()}}}function Un(t){let n,r,o,i,a;return{c(){n=T("a"),n.textContent="Steer the ship manually."},m(e,r){P(e,n,r),o=!0,i||(a=K(n,"click",t[13]),i=!0)},p:e,i(e){o||(e&&oe((()=>{o&&(r||(r=xe(n,$t,{duration:200},!0)),r.run(1))})),o=!0)},o(e){e&&(r||(r=xe(n,$t,{duration:200},!1)),r.run(0)),o=!1},d(e){e&&E(n),e&&r&&r.end(),i=!1,a()}}}function Yn(e){let t,n,r,o,i;return{c(){t=T("a"),n=A("Repair a hull breach. (Requires 1 sorted scrap)"),I(t,"style",r=e[2]<1?"color: grey;":"")},m(r,a){P(r,t,a),_(t,n),o||(i=K(t,"click",e[11]),o=!0)},p(e,n){4&n&&r!==(r=e[2]<1?"color: grey;":"")&&I(t,"style",r)},d(e){e&&E(t),o=!1,i()}}}function Wn(e){let t,n,r,o,i,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x,$,k,O,S,C,D,I,M,q,R,F,N,L=e[1]&&Hn(e),z=!e[3]&&Un(e),H=e[4]>0&&Yn(e);return w=new In({props:{event:e[5]}}),{c(){t=A("The front of your ship, where your pilot seat, computers, scanner and the window of molecularly reinforced glass are."),n=T("br"),r=A("\nYou can steer the ship manually to reduce the change of running into meteorites, your navigation computer only has a limited autopilot when it's computing and FTL flight.\n\n"),o=T("br"),i=j(),a=T("p"),s=A(e[0]),u=j(),c=T("br"),l=j(),L&&L.c(),f=j(),d=T("br"),h=j(),z&&z.c(),p=j(),y=T("br"),v=j(),H&&H.c(),m=j(),g=T("br"),b=j(),Oe(w.$$.fragment),x=j(),$=T("br"),k=T("br"),O=T("br"),S=j(),C=T("div"),D=T("a"),D.textContent="Got to the midsection",I=T("br")},m(E,T){P(E,t,T),P(E,n,T),P(E,r,T),P(E,o,T),P(E,i,T),P(E,a,T),_(a,s),P(E,u,T),P(E,c,T),P(E,l,T),L&&L.m(E,T),P(E,f,T),P(E,d,T),P(E,h,T),z&&z.m(E,T),P(E,p,T),P(E,y,T),P(E,v,T),H&&H.m(E,T),P(E,m,T),P(E,g,T),P(E,b,T),Se(w,E,T),P(E,x,T),P(E,$,T),P(E,k,T),P(E,O,T),P(E,S,T),P(E,C,T),_(C,D),_(C,I),R=!0,F||(N=K(D,"click",e[14]),F=!0)},p(e,t){let[n]=t;(!R||1&n)&&B(s,e[0]),e[1]?L?(L.p(e,n),2&n&&ve(L,1)):(L=Hn(e),L.c(),ve(L,1),L.m(f.parentNode,f)):L&&(pe(),me(L,1,1,(()=>{L=null})),ye()),e[3]?z&&(pe(),me(z,1,1,(()=>{z=null})),ye()):z?(z.p(e,n),8&n&&ve(z,1)):(z=Un(e),z.c(),ve(z,1),z.m(p.parentNode,p)),e[4]>0?H?H.p(e,n):(H=Yn(e),H.c(),H.m(m.parentNode,m)):H&&(H.d(1),H=null)},i(e){R||(ve(L),ve(z),ve(w.$$.fragment,e),e&&oe((()=>{R&&(q&&q.end(1),M=be(C,$t,{duration:200}),M.start())})),R=!0)},o(e){me(L),me(z),me(w.$$.fragment,e),M&&M.invalidate(),e&&(q=we(C,$t,{duration:200})),R=!1},d(e){e&&(E(t),E(n),E(r),E(o),E(i),E(a),E(u),E(c),E(l),E(f),E(d),E(h),E(p),E(y),E(v),E(m),E(g),E(b),E(x),E($),E(k),E(O),E(S),E(C)),L&&L.d(e),z&&z.d(e),H&&H.d(e),Pe(w,e),e&&q&&q.end(),F=!1,N()}}}function Vn(e,t,n){let r,o,i,a,s;var u;let f=Ke(null!==(u=dt.locals.event)&&void 0!==u?u:null),d=On(),h=d.scrap;l(e,h,(e=>n(2,i=e)));let p=d.navOffline;l(e,p,(e=>n(1,o=e)));let y=d.enginesOffline;l(e,y,(e=>n(3,a=e)));let v=d.breachesFront;l(e,v,(e=>n(4,s=e)));let m=Ie([d.meteorFrequency],(e=>c(d.meteorFrequency)<=.051?"You see practically not meteorites outside, even on your scanner.":c(d.meteorFrequency)<.21?"You see some meteorites outside":c(d.meteorFrequency)>=.26?"You see many meteorites outside. It's probably wise to steer the ship yourself for now.":c(d.meteorFrequency)>=.21?"You see quite a few meteorites outside.":void 0));return l(e,m,(e=>n(0,r=e))),[r,o,i,a,s,f,h,p,y,v,function(){c(h)>=2&&(h.set(c(h)-2),p.set(!1),f.set(Pn()))},function(){c(h)>=1&&(h.set(c(h)-1),v.set(c(v)-1),f.set(Pn()))},m,()=>f.set(Pn()),()=>Sn("midsection")]}class Gn extends Ae{constructor(e){super(),Ee(this,e,Vn,Wn,s,{})}}Te(Gn,{},[],[],!0);const Qn=Gn;function Xn(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML='<p>The ship enters FTL flight, and there&#39;s finally some quiet for you.<br>You fix up the ship a bit without haste, then go into the pilot seat and stare out into the shifting red fog that&#39;s always visible during FTL flight.</p><br><p>You reminisce about the past and what this ship has been through together with you.<br>It was at the brink of falling apart many times, but you always managed to fix it up.</p><br><p>You are pulled from your thought when the red fog fades into the blackness of space: <iff-link passage="front">The FTL flight has ended, and your work begins again</iff-link>.</p><br>'},p:e,i:e,o:e,d(e){e&&E(n)}}}function Jn(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML='<p>The ship enters FTL flight, and there&#39;s finally some quiet for you.<br>You fix up the ship a bit without haste, then go into the pilot seat and stare out into the shifting red fog that&#39;s always visible during FTL flight.</p><br><p>You remember your many trades with foreign species: Most of them gave you a bad price (in your opinion) for what you salvaged, but there are a few key trades where you made a great deal. Like one time you sold a completely intact shield generator that would have sucked up too much power for your ship anyways and got your current navigation computer. At the time, it was a threefold upgrade for you.</p><br><p>You are pulled from your thought when the red fog fades into the blackness of space: <iff-link passage="front">The FTL flight has ended, and your work begins again</iff-link>.</p><br>'},p:e,i:e,o:e,d(e){e&&E(n)}}}function Zn(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML='<p>The ship enters FTL flight, and there&#39;s finally some quiet for you.<br>You fix up the ship a bit without haste, then go into the pilot seat and stare out into the shifting red fog that&#39;s always visible during FTL flight.</p><br><p>This time your thoughts stay in the here and now, or rather in the future. You think about what things you might loot from the battlefield.<br>Maybe another shield generator? Though those tend to burn out from heavy fire, so that&#39;s unlikely</p><br><p>You are pulled from your thought when the red fog fades into the blackness of space: <iff-link passage="end">The FTL flight has ended, and your work begins again</iff-link>.</p><br>'},p:e,i:e,o:e,d(e){e&&E(n)}}}function er(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML='<p>You&#39;re a space vulture: You feed off the remains of other ships to repair yours and sell what you don&#39;t need.<br>It doesn&#39;t make much, but makes a living. Mostly.</p><br><p>Currently, things are not goings so well. The last 2 battlegrounds you visited have already been plundered, and your ship, the Cantlery, is slowly falling apart, as always.<br>You estimate there will be 3 FTL flight stages until you reach the next wreckage field, which is hopefully still fresh.<br>Fewer FTL stages would be risky, as your old navigation computer isn&#39;t able to accurately compute such long flights.<br>It has trouble even with smaller FTL flights: It always needs a while to compute the next one.</p><br><p>You are distracted in your thoughts by a sudden a hissing noise: The oxygen generator on your space suit (which you always wear, for safety) is broken again.<br>You get up from your pilot seat and go to your workbench in the midsection to fix it and hastily put the suit back on.</p><br><p><iff-link passage="midsection">Continue</iff-link></p><br>'},p:e,i:e,o:e,d(e){e&&E(n)}}}function tr(e){let t,n,r,o,i;return{c(){t=T("a"),n=A("Repair a hull breach. (Requires 1 sorted scrap)"),I(t,"style",r=e[3]<1?"color: grey;":"")},m(r,a){P(r,t,a),_(t,n),o||(i=K(t,"click",e[8]),o=!0)},p(e,n){8&n&&r!==(r=e[3]<1?"color: grey;":"")&&I(t,"style",r)},d(e){e&&E(t),o=!1,i()}}}function nr(e){let t,n,r;return{c(){t=T("p"),t.textContent="You found some useful bits."},m(e,n){P(e,t,n),r=!0},i(e){r||(e&&oe((()=>{r&&(n||(n=xe(t,kt,{axis:"y",duration:500},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,kt,{axis:"y",duration:500},!1)),n.run(0)),r=!1},d(e){e&&E(t),e&&n&&n.end()}}}function rr(e){let t,n,r;return{c(){t=T("p"),t.textContent="You found nothing useful."},m(e,n){P(e,t,n),r=!0},i(e){r||(e&&oe((()=>{r&&(n||(n=xe(t,kt,{axis:"y",duration:500},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,kt,{axis:"y",duration:500},!1)),n.run(0)),r=!1},d(e){e&&E(t),e&&n&&n.end()}}}function or(e){let t,n,r,o,a,s,u,c,l,f;return{c(){t=T("div"),n=T("a"),n.textContent="Got to the front",r=T("br"),o=j(),a=T("a"),a.textContent="Got to the aft"},m(i,s){P(i,t,s),_(t,n),_(t,r),_(t,o),_(t,a),c=!0,l||(f=[K(n,"click",e[9]),K(a,"click",e[10])],l=!0)},i(e){c||(e&&oe((()=>{c&&(u&&u.end(1),s=be(t,$t,{duration:200}),s.start())})),c=!0)},o(e){s&&s.invalidate(),e&&(u=we(t,$t,{duration:200})),c=!1},d(e){e&&E(t),e&&u&&u.end(),l=!1,i(f)}}}function ir(e){let t,n,r,o,i,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x,$,k=e[2]>0&&tr(e),O=!0===e[0]&&nr(),S=!1===e[0]&&rr();h=new In({props:{event:e[6]}});let C=!e[1]&&or(e);return{c(){t=T("p"),n=A("You are in the ship's midsection."),r=T("br"),o=A("\n    Here is your workbench and your tools, as well as the piles of sorted and unsorted scrap you have."),i=T("br"),a=A("\n    You already used up the most useful parts of the scrap long ago, but a "),s=T("a"),s.textContent="thorough search",u=A(" might still reveal something."),c=j(),k&&k.c(),l=j(),O&&O.c(),f=j(),S&&S.c(),d=j(),Oe(h.$$.fragment),p=j(),y=T("br"),v=T("br"),m=T("br"),g=j(),C&&C.c(),b=D()},m(E,T){P(E,t,T),_(t,n),_(t,r),_(t,o),_(t,i),_(t,a),_(t,s),_(t,u),P(E,c,T),k&&k.m(E,T),P(E,l,T),O&&O.m(E,T),P(E,f,T),S&&S.m(E,T),P(E,d,T),Se(h,E,T),P(E,p,T),P(E,y,T),P(E,v,T),P(E,m,T),P(E,g,T),C&&C.m(E,T),P(E,b,T),w=!0,x||($=K(s,"click",e[7]),x=!0)},p(e,t){let[n]=t;e[2]>0?k?k.p(e,n):(k=tr(e),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null),!0===e[0]?O?1&n&&ve(O,1):(O=nr(),O.c(),ve(O,1),O.m(f.parentNode,f)):O&&(pe(),me(O,1,1,(()=>{O=null})),ye()),!1===e[0]?S?1&n&&ve(S,1):(S=rr(),S.c(),ve(S,1),S.m(d.parentNode,d)):S&&(pe(),me(S,1,1,(()=>{S=null})),ye()),e[1]?C&&(pe(),me(C,1,1,(()=>{C=null})),ye()):C?2&n&&ve(C,1):(C=or(e),C.c(),ve(C,1),C.m(b.parentNode,b))},i(e){w||(ve(O),ve(S),ve(h.$$.fragment,e),ve(C),w=!0)},o(e){me(O),me(S),me(h.$$.fragment,e),me(C),w=!1},d(e){e&&(E(t),E(c),E(l),E(f),E(d),E(p),E(y),E(v),E(m),E(g),E(b)),k&&k.d(e),O&&O.d(e),S&&S.d(e),Pe(h,e),C&&C.d(e),x=!1,$()}}}function ar(e,t,n){let r,o;var i;let a,s,u=On(),f=u.breachesMid;l(e,f,(e=>n(2,r=e)));let d=u.scrap;l(e,d,(e=>n(3,o=e)));let h=Ke(null!==(i=dt.locals.event)&&void 0!==i?i:null);return X((()=>{s&&clearTimeout(s)})),[a,s,r,o,f,d,h,function(){n(0,a=void 0),s||(n(1,s=setTimeout((()=>{n(0,a=u.rng.nextBool()),h.set(Pn()),a&&(d.set(c(d)+1),dt.saveSession()),n(1,s=void 0)}),2e3)),h.set(null))},function(){c(d)>=1&&(d.set(c(d)-1),f.set(c(f)-1),h.set(Pn()))},()=>Sn("front"),()=>Sn("aft")]}class sr extends Ae{constructor(e){super(),Ee(this,e,ar,ir,s,{})}}Te(sr,{},[],[],!0);const ur=sr;function cr(t){let n;return{c(){n=T("div")},m(e,t){P(e,n,t),n.innerHTML='<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; width: 100%;"><br><br><h1>Outer Space</h1><br><p>Try to survive in a crumbling spaceship until you reach the next wreckage field to repair it.</p><br><p><em><a href="https://github.com/tareksander/IF-Framework/tree/main">An IF-Framework demo game</a></em></p><br><p><iff-link passage="intro">Begin</iff-link></p><br></div>'},p:e,i:e,o:e,d(e){e&&E(n)}}}const lr=[new ut("aft",[],{},Nn),new ut("end",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,Ln,s,{})}}),new ut("fail",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,zn,s,{})}}),new ut("front",[],{},Qn),new ut("ftl1",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,Xn,s,{})}}),new ut("ftl2",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,Jn,s,{})}}),new ut("ftl3",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,Zn,s,{})}}),new ut("intro",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,er,s,{})}}),new ut("midsection",[],{},ur),new ut("start",[],{},class extends Ae{constructor(e){super(),Ee(this,e,null,cr,s,{})}})];function fr(e){$(e,"svelte-jfek9x",".container.svelte-jfek9x{display:flex;align-items:center;justify-content:center;flex-direction:column;row-gap:0.25em;width:100%;padding:2em;border-bottom:1px solid var(--ui-primary-color)}@keyframes svelte-jfek9x-warning{from{color:rgb(255, 100, 100)}to{color:rgb(240, 45, 45)}}.red.svelte-jfek9x{animation:1s linear infinite alternate svelte-jfek9x-warning;color:rgb(255, 100, 100)}")}function dr(e){let t,n,r,o,i,a,s,u,c,l,f,d,h,p,y,v,m,g,b,w,x,$,k,O,S,C,D,K,M,R,F=e[5]>0&&hr(e),N=e[6]>0&&pr(e),L=e[7]>0&&yr(e),z=e[8]&&vr(),H=e[9]&&mr();return{c(){t=T("div"),n=T("div"),r=T("span"),o=A("Hull integrity: "),i=A(e[1]),a=A("%"),s=j(),u=T("span"),c=A("FTL calculation: "),l=A(e[2]),f=A("%"),d=j(),h=T("div"),p=T("span"),y=A("Fuel: "),v=A(e[3]),m=A("%"),g=j(),b=T("span"),w=A("Sorted scrap: "),x=A(e[4]),$=A(" Handfuls"),k=j(),F&&F.c(),O=j(),N&&N.c(),S=j(),L&&L.c(),C=j(),z&&z.c(),D=j(),H&&H.c(),q(r,"margin-right","2em"),q(p,"margin-right","2em"),I(t,"class","container svelte-jfek9x")},m(e,E){P(e,t,E),_(t,n),_(n,r),_(r,o),_(r,i),_(r,a),_(n,s),_(n,u),_(u,c),_(u,l),_(u,f),_(t,d),_(t,h),_(h,p),_(p,y),_(p,v),_(p,m),_(h,g),_(h,b),_(b,w),_(b,x),_(b,$),_(t,k),F&&F.m(t,null),_(t,O),N&&N.m(t,null),_(t,S),L&&L.m(t,null),_(t,C),z&&z.m(t,null),_(t,D),H&&H.m(t,null),R=!0},p(e,n){(!R||2&n)&&B(i,e[1]),(!R||4&n)&&B(l,e[2]),(!R||8&n)&&B(v,e[3]),(!R||16&n)&&B(x,e[4]),e[5]>0?F?(F.p(e,n),32&n&&ve(F,1)):(F=hr(e),F.c(),ve(F,1),F.m(t,O)):F&&(pe(),me(F,1,1,(()=>{F=null})),ye()),e[6]>0?N?(N.p(e,n),64&n&&ve(N,1)):(N=pr(e),N.c(),ve(N,1),N.m(t,S)):N&&(pe(),me(N,1,1,(()=>{N=null})),ye()),e[7]>0?L?(L.p(e,n),128&n&&ve(L,1)):(L=yr(e),L.c(),ve(L,1),L.m(t,C)):L&&(pe(),me(L,1,1,(()=>{L=null})),ye()),e[8]?z?256&n&&ve(z,1):(z=vr(),z.c(),ve(z,1),z.m(t,D)):z&&(pe(),me(z,1,1,(()=>{z=null})),ye()),e[9]?H?512&n&&ve(H,1):(H=mr(),H.c(),ve(H,1),H.m(t,null)):H&&(pe(),me(H,1,1,(()=>{H=null})),ye())},i(e){R||(ve(F),ve(N),ve(L),ve(z),ve(H),e&&oe((()=>{R&&(M&&M.end(1),K=be(t,kt,{axis:"y"}),K.start())})),R=!0)},o(e){me(F),me(N),me(L),me(z),me(H),K&&K.invalidate(),e&&(M=we(t,$t,{duration:200})),R=!1},d(e){e&&E(t),F&&F.d(),N&&N.d(),L&&L.d(),z&&z.d(),H&&H.d(),e&&M&&M.end()}}}function hr(e){let t,n,r,o,i;return{c(){t=T("div"),n=A("Hull breaches in the front: "),r=A(e[5]),I(t,"class","red svelte-jfek9x")},m(e,o){P(e,t,o),_(t,n),_(t,r),i=!0},p(e,t){(!i||32&t)&&B(r,e[5])},i(e){i||(e&&oe((()=>{i&&(o||(o=xe(t,kt,{axis:"y"},!0)),o.run(1))})),i=!0)},o(e){e&&(o||(o=xe(t,kt,{axis:"y"},!1)),o.run(0)),i=!1},d(e){e&&E(t),e&&o&&o.end()}}}function pr(e){let t,n,r,o,i;return{c(){t=T("div"),n=A("Hull breaches in the midsection: "),r=A(e[6]),I(t,"class","red svelte-jfek9x")},m(e,o){P(e,t,o),_(t,n),_(t,r),i=!0},p(e,t){(!i||64&t)&&B(r,e[6])},i(e){i||(e&&oe((()=>{i&&(o||(o=xe(t,kt,{axis:"y"},!0)),o.run(1))})),i=!0)},o(e){e&&(o||(o=xe(t,kt,{axis:"y"},!1)),o.run(0)),i=!1},d(e){e&&E(t),e&&o&&o.end()}}}function yr(e){let t,n,r,o,i;return{c(){t=T("div"),n=A("Hull breaches in the aft: "),r=A(e[7]),I(t,"class","red svelte-jfek9x")},m(e,o){P(e,t,o),_(t,n),_(t,r),i=!0},p(e,t){(!i||128&t)&&B(r,e[7])},i(e){i||(e&&oe((()=>{i&&(o||(o=xe(t,kt,{axis:"y"},!0)),o.run(1))})),i=!0)},o(e){e&&(o||(o=xe(t,kt,{axis:"y"},!1)),o.run(0)),i=!1},d(e){e&&E(t),e&&o&&o.end()}}}function vr(e){let t,n,r;return{c(){t=T("div"),t.textContent="Navigation computer offline",I(t,"class","red svelte-jfek9x")},m(e,n){P(e,t,n),r=!0},i(e){r||(e&&oe((()=>{r&&(n||(n=xe(t,kt,{axis:"y"},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,kt,{axis:"y"},!1)),n.run(0)),r=!1},d(e){e&&E(t),e&&n&&n.end()}}}function mr(e){let t,n,r;return{c(){t=T("div"),t.textContent="Engines offline",I(t,"class","red svelte-jfek9x")},m(e,n){P(e,t,n),r=!0},i(e){r||(e&&oe((()=>{r&&(n||(n=xe(t,kt,{axis:"y"},!0)),n.run(1))})),r=!0)},o(e){e&&(n||(n=xe(t,kt,{axis:"y"},!1)),n.run(0)),r=!1},d(e){e&&E(t),e&&n&&n.end()}}}function gr(e){let t,n="start"!=e[0].name&&"intro"!=e[0].name&&!e[0].name.includes("ftl"),r=n&&dr(e);return{c(){r&&r.c(),t=D()},m(e,n){r&&r.m(e,n),P(e,t,n)},p(e,o){let[i]=o;1&i&&(n="start"!=e[0].name&&"intro"!=e[0].name&&!e[0].name.includes("ftl")),n?r?(r.p(e,i),1&i&&ve(r,1)):(r=dr(e),r.c(),ve(r,1),r.m(t.parentNode,t)):r&&(pe(),me(r,1,1,(()=>{r=null})),ye())},i(e){ve(r)},o(e){me(r)},d(e){e&&E(t),r&&r.d(e)}}}function br(e,t,n){let r,o,i,a,s,u,c,f,d,h;l(e,_n,(e=>n(1,o=e)));let p=On(),y=p.progress;l(e,y,(e=>n(2,i=e)));let v=p.breachesFront;l(e,v,(e=>n(5,u=e)));let m=p.breachesMid;l(e,m,(e=>n(6,c=e)));let g=p.breachesAft;l(e,g,(e=>n(7,f=e)));let b=p.fuel;l(e,b,(e=>n(3,a=e)));let w=p.scrap;l(e,w,(e=>n(4,s=e)));let x=p.navOffline;l(e,x,(e=>n(8,d=e)));let _=p.enginesOffline;l(e,_,(e=>n(9,h=e)));let $=dt.currentPassage;return l(e,$,(e=>n(0,r=e))),[r,o,i,a,s,u,c,f,d,h,y,v,m,g,b,w,x,_,$]}class wr extends Ae{constructor(e){super(),Ee(this,e,br,gr,s,{},fr)}}Te(wr,{},[],[],!0);const xr=wr;let _r=()=>{Me.historyLimit=2,Me.userNavigable.set(!1),dt.addPassages(lr),dt.init(new lt([new ct("start",{})],0),0),kn(),customElements.define("iff-link",bt.element),document.getElementById("iff-noscript-container")?.remove(),new xn({target:document.body,props:{sidebarComponents:[],header:xr,footer:null}}),xt.register().catch((e=>console.log(e)))};"loading"==document.readyState?window.addEventListener("DOMContentLoaded",_r):_r()})()})();